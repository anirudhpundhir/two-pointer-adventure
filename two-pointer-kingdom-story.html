<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Two Pointers Adventure - Master the Technique!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow: hidden;
        }

        .presentation-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        .slide {
            display: none;
            padding: 40px;
            text-align: center;
            height: 100vh;
            overflow-y: auto;
        }

        .slide.active {
            display: block;
            animation: slideIn 0.5s ease-in-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 10px rgba(255,235,59,0.5); }
            50% { box-shadow: 0 0 25px rgba(255,235,59,0.8); }
            100% { box-shadow: 0 0 10px rgba(255,235,59,0.5); }
        }

        h1 {
            font-size: 3em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        h2 {
            font-size: 2.5em;
            margin-bottom: 25px;
            color: #ffeb3b;
        }

        h3 {
            font-size: 2em;
            margin-bottom: 20px;
            color: #4fc3f7;
        }

        .content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .story-box {
            background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
            border-radius: 20px;
            padding: 30px;
            margin: 25px 0;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
            overflow: hidden;
        }

        .story-box::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.03), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        .gamification-box {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            animation: pulse 2s infinite;
            position: relative;
        }

        .brain-teaser {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border: 2px solid #ffeb3b;
            animation: glow 2s infinite;
        }

        .coding-challenge {
            background: linear-gradient(135deg, rgba(0,0,0,0.4), rgba(0,0,0,0.2));
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border-left: 5px solid #4fc3f7;
        }

        .array-visualization {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .array-element {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #4fc3f7, #29b6f6);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            font-weight: bold;
            color: white;
            transition: all 0.4s ease;
            position: relative;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .array-element.pointer-left {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            transform: scale(1.3);
            box-shadow: 0 0 25px rgba(255,68,68,0.6);
            animation: pulse 1s infinite;
        }

        .array-element.pointer-right {
            background: linear-gradient(135deg, #44ff44, #00cc00);
            transform: scale(1.3);
            box-shadow: 0 0 25px rgba(68,255,68,0.6);
            animation: pulse 1s infinite;
        }

        .array-element.both-pointers {
            background: linear-gradient(135deg, #ff8844, #cc4400);
            transform: scale(1.4);
            box-shadow: 0 0 30px rgba(255,136,68,0.8);
            animation: glow 1s infinite;
        }

        .pointer-label {
            position: absolute;
            top: -35px;
            font-size: 0.9em;
            font-weight: bold;
            color: #ffeb3b;
        }

        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 15px 25px;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1));
            border: none;
            border-radius: 30px;
            color: white;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn:hover {
            background: linear-gradient(135deg, rgba(255,255,255,0.3), rgba(255,255,255,0.2));
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn.primary {
            background: linear-gradient(135deg, #ffeb3b, #ffc107);
            color: #333;
        }

        .btn.success {
            background: linear-gradient(135deg, #4caf50, #388e3c);
        }

        .btn.danger {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .slide-counter {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1));
            padding: 15px 25px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .score-board {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            padding: 15px 25px;
            border-radius: 25px;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        .algorithm-step {
            background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
            border-left: 4px solid #ffeb3b;
            padding: 20px 25px;
            margin: 20px 0;
            border-radius: 10px;
            text-align: left;
            backdrop-filter: blur(10px);
        }

        .code-block {
            background: linear-gradient(135deg, rgba(0,0,0,0.4), rgba(0,0,0,0.2));
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            font-family: 'Courier New', monospace;
            text-align: left;
            line-height: 1.8;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .highlight {
            background: linear-gradient(135deg, rgba(255,235,59,0.4), rgba(255,235,59,0.2));
            padding: 3px 8px;
            border-radius: 5px;
            color: #ffeb3b;
            font-weight: bold;
        }

        .interactive-demo {
            margin: 30px 0;
            padding: 25px;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .problem-statement {
            background: linear-gradient(135deg, rgba(255,68,68,0.3), rgba(255,68,68,0.1));
            border: 2px solid #ff4444;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }

        .solution-approach {
            background: linear-gradient(135deg, rgba(68,255,68,0.3), rgba(68,255,68,0.1));
            border: 2px solid #44ff44;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }

        .hint-box {
            background: linear-gradient(135deg, rgba(255,235,59,0.3), rgba(255,235,59,0.1));
            border: 2px dashed #ffeb3b;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .comparison-table {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .comparison-item {
            background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .emoji {
            font-size: 1.8em;
            margin: 0 10px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Single source of truth for hidden (overrides safely) */
        .hidden { display: none !important; }

        .quiz-option {
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1));
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            margin: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .quiz-option:hover {
            border-color: #ffeb3b;
            transform: translateX(10px);
        }

        .quiz-option.correct {
            border-color: #4caf50;
            background: linear-gradient(135deg, rgba(76,175,80,0.3), rgba(76,175,80,0.1));
        }

        .quiz-option.incorrect {
            border-color: #f44336;
            background: linear-gradient(135deg, rgba(244,67,54,0.3), rgba(244,67,54,0.1));
        }

        input, textarea {
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 10px;
            padding: 15px;
            font-size: 1.1em;
            margin: 10px;
            color: #333;
            width: 300px;
        }

        /* ========= Leaderboard (tray + compact/full) ========= */
        .leaderboard-tray{
            position: fixed; top: 20px; left: 20px; z-index: 9999;
            display: flex; flex-direction: column; gap: 10px;
        }
        .leaderboard{
            width: 320px; max-height: 260px; overflow: auto;
            background: linear-gradient(135deg, rgba(255,255,255,0.18), rgba(255,255,255,0.06));
            border: 1px solid rgba(255,255,255,0.25); border-radius: 16px; padding: 12px;
            backdrop-filter: blur(10px);
        }
        .leaderboard.compact{ max-height: 160px }
        .leaderboard.full{ max-height: 420px }
        .lb-row{
            display: flex; justify-content: space-between; align-items: center;
            padding: 8px 10px; margin: 6px 0; border-radius: 10px;
            background: linear-gradient(135deg, rgba(0,0,0,0.15), rgba(255,255,255,0.05));
            font-size: 0.95em;
        }
        .lb-row .lb-name{ font-weight: 700; color: #ffeb3b }
        .lb-row .lb-score{ font-weight: 700 }
        .lb-meta{ font-size: 0.8em; opacity: 0.9 }
        .lb-btn{
            padding: 10px 14px; border: 1px solid rgba(255,255,255,0.3);
            background: linear-gradient(135deg, rgba(255,255,255,0.22), rgba(255,255,255,0.12));
            color: white; border-radius: 999px; cursor: pointer; font-weight: 700;
            transition: transform .2s ease;
        }
        .lb-btn:hover{ transform: translateY(-2px) }
        .lb-btn.danger{
            background: linear-gradient(135deg, #f44336, #d32f2f);
            border-color: rgba(0,0,0,0.15)
        }
        .leaderboard-actions{ display:flex; gap:10px; }

        /* ========= Winner Modal (scoped to avoid clashes) ========= */
        .lb-modal{
            position: fixed; inset: 0; background: rgba(0,0,0,0.55);
            display: grid; place-items: center; z-index: 10000;
        }
        .lb-card{
            width: min(560px, 94vw);
            background: linear-gradient(135deg, rgba(255,255,255,0.18), rgba(255,255,255,0.08));
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 16px; padding: 16px 16px 10px; backdrop-filter: blur(10px);
        }
        .lb-card-head{ display:flex; align-items:center; justify-content:space-between; margin-bottom: 10px; }
        .lb-card-title{ font-weight: 800; font-size: 1.2rem; }
        .lb-card-sub{ opacity: .85; font-size: .95rem; }
        .lb-x{ background: transparent; border: none; color: white; font-size: 1.2rem; cursor: pointer; }

        .lb-rows-head{ display:grid; grid-template-columns: 1fr 120px 36px; gap: 8px; font-weight:700; opacity:.9; margin: 6px 2px; }
        .lb-rows{ display:flex; flex-direction:column; gap: 8px; max-height: 40vh; overflow:auto; padding-right: 2px; }

        /* Modal rows override: keep leaderboard rows flex, but modal rows are grid */
        .lb-modal .lb-row{ display:grid; grid-template-columns: 1fr 120px 36px; gap: 8px; }
        .lb-modal .lb-row input{
            width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.35);
            background: rgba(255,255,255,0.9); color:#333; font-size: 0.95rem;
        }
        .lb-modal .lb-row .rm{
            border: 1px solid rgba(255,255,255,0.3); border-radius: 10px; cursor: pointer;
            background: linear-gradient(135deg, rgba(255,255,255,0.22), rgba(255,255,255,0.12));
        }
        .lb-modal .lb-row .rm:hover{ transform: translateY(-1px); }

        .lb-row-actions{ display:flex; gap:10px; align-items:center; margin-top: 12px; }
        .lb-spacer{ flex:1; }
        .lb-btn.primary{
            background: linear-gradient(135deg, #ffeb3b, #ffc107); color: #333; border-color: rgba(0,0,0,0.12);
        }
    </style>
</head>
<body>
    <div class="presentation-container">
        <!-- Score Board -->
         <!-- Leaderboard (collapsible) -->
        <div id="leaderboard-stats" style="opacity:.9;font-weight:700;">
         Top Score: <span id="top-score">0</span> • Total Players: <span id="player-count">0</span>
        </div>
        <div id="leaderboard-tray" class="leaderboard-tray">
        <button id="leaderboard-toggle" class="lb-btn">🏅 Leaderboard</button>
        <div id="leaderboard-compact" class="leaderboard compact"></div>
        <div id="leaderboard-full" class="leaderboard full hidden"></div>
        <div class="leaderboard-actions hidden" id="leaderboard-actions">
            <button class="lb-btn" id="leaderboard-collapse">Collapse</button>
            <button class="lb-btn danger" id="leaderboard-clear">Clear</button>
        </div>
        </div>
        <div class="score-board">
            🏆 Score: <span id="score">0</span> | 🎯 Level: <span id="level">Beginner</span>
        </div>

        <!-- Slide 1: Title with Adventure Theme -->
        <div class="slide active">
            <div class="content">
                <h1>🚀 The Two Pointers Adventure</h1>
                <h3>Master the Art of Efficient Problem Solving!</h3>
                
                <div class="story-box">
                    <h3>🏰 The Legend Begins...</h3>
                    <p style="font-size: 1.4em; line-height: 1.6;">
                        In the mystical Kingdom of Algorithms, there lived two brave knights: 
                        <strong>Sir Left-Pointer</strong> and <strong>Dame Right-Pointer</strong>. 
                        They possessed a magical ability to solve the most complex treasure hunts 
                        by working together, moving strategically through arrays of challenges.
                    </p>
                    <p style="font-size: 1.2em; margin-top: 20px; color: #ffeb3b;">
                        Today, you shall learn their ancient techniques and become a master problem-solver yourself!
                    </p>
                </div>

                <div class="gamification-box">
                    <h3>🎮 Your Quest Today</h3>
                    <p>Complete challenges, solve brain teasers, and unlock coding mastery!</p>
                    <div class="progress-bar">
                        <div class="progress-fill" id="quest-progress" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 2: The Origin Story -->
        <div class="slide">
            <div class="content">
                <h2>📚 Chapter 1: The Origin Story</h2>
                
                <div class="story-box">
                    <h3>🎭 The Tale of the Inefficient Merchant</h3>
                    <p style="font-size: 1.3em; line-height: 1.6;">
                        Once upon a time, a merchant named Bruno had a peculiar problem. His treasure chest contained 
                        coins arranged in perfect order from smallest to largest value. Customers would come asking 
                        for two specific coins that added up to exactly the price of their desired item.
                    </p>
                    <p style="font-size: 1.2em; margin-top: 15px;">
                        Bruno's approach? <strong>"Let me check every single coin with every other coin!"</strong> 
                        For 1000 coins, that meant nearly 500,000 comparisons! Customers waited for hours! 😴
                    </p>
                </div>

                <div class="brain-teaser">
                    <h3>🧠 Brain Teaser #1</h3>
                    <p style="font-size: 1.2em; margin-bottom: 20px;">
                        If Bruno has 10 coins and checks every pair, how many comparisons does he make?
                    </p>
                    <button class="btn primary" onclick="revealAnswer(1)">Show answer!</button>
                    <div id="answer1" class="hidden" style="margin-top: 15px; font-size: 1.1em;">
                        <strong>Answer:</strong> 45 comparisons! (10 × 9 ÷ 2 = 45)<br>
                        For n coins: n × (n-1) ÷ 2 = O(n²) - That's inefficient! 😱
                        <br><strong>+10 points!</strong> 🎉
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 3: The Heroes Arrive -->
        <div class="slide">
            <div class="content">
                <h2>⚔️ Chapter 2: The Heroes Arrive</h2>
                
                <div class="story-box">
                    <h3>🌟 Enter the Two Pointer Knights</h3>
                    <p style="font-size: 1.3em; line-height: 1.6;">
                        One day, Sir Left-Pointer and Dame Right-Pointer heard about Bruno's problem. 
                        They arrived with a revolutionary strategy:
                    </p>
                    <div style="font-size: 1.2em; margin: 20px 0; text-align: left;">
                        <p><strong>Sir Left-Pointer:</strong> "I'll start from the smallest coin!"</p>
                        <p><strong>Dame Right-Pointer:</strong> "And I'll start from the largest!"</p>
                        <p><strong>Both:</strong> "Together, we'll find the answer in just ONE pass!"</p>
                    </div>
                </div>

                <div class="interactive-demo">
                    <h3>🎯 Watch the Magic!</h3>
                    <p>Coins: [2, 7, 11, 15], Target: 9</p>
                    <div class="array-visualization" id="hero-demo">
                        <div class="array-element">2</div>
                        <div class="array-element">7</div>
                        <div class="array-element">11</div>
                        <div class="array-element">15</div>
                    </div>
                    <button class="btn primary" onclick="startHeroDemo()">Watch Heroes in Action!</button>
                    <div id="hero-narrative" style="margin-top: 20px; font-size: 1.1em; min-height: 50px;">
                        Click the button to see our heroes solve this in just 2 steps!
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 4: The Algorithm Revealed -->
        <div class="slide">
            <div class="content">
                <h2>📜 Chapter 3: The Ancient Algorithm</h2>
                
                <div class="story-box">
                    <h3>🔮 The Sacred Technique</h3>
                    <p style="font-size: 1.2em;">
                        The knights revealed their time-honored strategy, passed down through generations of algorithm masters:
                    </p>
                </div>

                <div class="algorithm-step">
                    <strong>🎯 Step 1:</strong> Position yourself at the extremes (left at minimum, right at maximum)
                </div>
                <div class="algorithm-step">
                    <strong>⚖️ Step 2:</strong> Evaluate your current situation (calculate the sum)
                </div>
                <div class="algorithm-step">
                    <strong>🤔 Step 3:</strong> Make the smart decision:
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>If sum equals target → Victory! 🎉</li>
                        <li>If sum is too small → Left knight moves right (need bigger value)</li>
                        <li>If sum is too large → Right knight moves left (need smaller value)</li>
                    </ul>
                </div>
                <div class="algorithm-step">
                    <strong>🔄 Step 4:</strong> Repeat until victory or knights meet
                </div>

                <div class="brain-teaser">
                    <h3>🤔 Quick Quiz!</h3>
                    <p>In array [1, 3, 5, 8, 12] looking for sum = 13, if current sum = 1 + 12 = 13, what do we do?</p>
                    <div class="quiz-option" onclick="checkAnswer('A', true)">A) We found our answer! 🎉</div>
                    <div class="quiz-option" onclick="checkAnswer('B', false)">B) Move left pointer right</div>
                    <div class="quiz-option" onclick="checkAnswer('C', false)">C) Move right pointer left</div>
                </div>
            </div>
        </div>

        <!-- Slide 5: First Challenge - Two Sum Story -->
        <div class="slide">
            <div class="content">
                <h2>🎯 Challenge 1: The Merchant's First Case</h2>
                
                <div class="story-box">
                    <h3>💰 The Golden Coin Challenge</h3>
                    <p style="font-size: 1.2em; line-height: 1.6;">
                        A wealthy customer enters Bruno's shop with exactly 9 gold pieces. She needs to pay using 
                        exactly two coins from Bruno's sorted collection. The coins available are: [2, 7, 11, 15].
                        Can our heroes help Bruno find the right combination quickly?
                    </p>
                </div>

                <div class="coding-challenge">
                    <h3>💻 Coding Challenge: Two Sum</h3>
                    <div class="problem-statement">
                        <strong>Problem:</strong> Given a sorted array of integers and a target sum, 
                        find the indices of two numbers that add up to the target.
                        <br><br>
                        <strong>Input:</strong> nums = [2, 7, 11, 15], target = 9
                        <br>
                        <strong>Expected Output:</strong> [0, 1] (because nums[0] + nums[1] = 2 + 7 = 9)
                    </div>

                    <div class="hint-box">
                        <strong>🔍 Hints:</strong>
                        <p>Think about what the knights would do! Start from both ends and work towards the center.</p>
                        <button class="btn" onclick="showHint('twosum')">Show More Hints</button>
                        <div id="twosum-hints" class="hidden">
                            <ul style="text-align: left; margin: 10px 0;">
                                <li>Use two pointers: left starts at index 0, right starts at last index</li>
                                <li>If sum is too small, move left pointer right (get a larger number)</li>
                                <li>If sum is too large, move right pointer left (get a smaller number)</li>
                            </ul>
                        </div>
                    </div>

                    <button class="btn primary" onclick="showSolution('twosum')">Show Solution & Analysis</button>
                    <div id="twosum-solution" class="hidden">
                        <div class="code-block"><strong>Java</strong>
                        <pre>public static int[] twoSumSorted(int[] nums, int target) {
                        int left = 0, right = nums.length - 1;
                        while (left &lt; right) {
                            int sum = nums[left] + nums[right];
                            if (sum == target) return new int[]{left, right};
                            if (sum &lt; target) left++;
                            else right--;
                        }
                        return new int[]{-1, -1};
                        }</pre>
                        </div>
                        <div class="comparison-table">
                            <div class="comparison-item">
                                <h4>🐌 Brute Force</h4>
                                <p>Time: O(n²)</p>
                                <p>Space: O(1)</p>
                                <p>Checks all pairs</p>
                            </div>
                            <div class="comparison-item">
                                <h4>⚡ Two Pointers</h4>
                                <p>Time: O(n)</p>
                                <p>Space: O(1)</p>
                                <p>Single pass!</p>
                            </div>
                            <div class="comparison-item">
                                <h4>🏆 Winner</h4>
                                <p style="color: #4caf50;">Two Pointers!</p>
                                <p>Linear time</p>
                                <p>Elegant solution</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 6: Interactive Two Sum Demo -->
        <div class="slide">
            <div class="content">
                <h2>🎬 Live Demo: Two Sum Adventure</h2>
                
                <div class="interactive-demo">
                    <h3>🎭 Watch Our Heroes Work Together!</h3>
                    <p style="font-size: 1.2em;">Array: [2, 7, 11, 15], Target: 9</p>
                    
                    <div class="array-visualization" id="two-sum-demo">
                        <!-- Populated by JavaScript -->
                    </div>
                    
                    <div id="step-narrative" style="font-size: 1.2em; margin: 25px 0; min-height: 80px; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                        🎬 Ready for the show! Our knights are prepared to demonstrate their legendary technique.
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <button class="btn success" onclick="runTwoSumStory()">▶️ Start Adventure</button>
                        <button class="btn" onclick="resetDemo()">🔄 Reset</button>
                        <button class="btn danger" onclick="nextDemoStep()">⏭️ Next Step</button>
                    </div>
                </div>

                <div class="brain-teaser">
                    <h3>🧠 Quick Challenge!</h3>
                    <p>Try it yourself! Array: [1, 2, 3, 4, 6], Target: 6</p>
                    <p>Which two numbers add up to 6?</p>
                    <input type="text" id="student-answer" placeholder="Enter indices (e.g., 1,3)">
                    <button class="btn primary" onclick="checkStudentAnswer()">Check Answer</button>
                    <div id="student-feedback" style="margin-top: 15px; font-size: 1.1em;"></div>
                </div>
            </div>
        </div>

        <!-- Slide 7: Palindrome Story Challenge -->
        <div class="slide">
            <div class="content">
                <h2>🪞 Challenge 2: The Mirror Kingdom</h2>
                
                <div class="story-box">
                    <h3>✨ The Enchanted Word Spell</h3>
                    <p style="font-size: 1.3em; line-height: 1.6;">
                        In the Mirror Kingdom, words hold magical power, but only palindromes (words that read 
                        the same forwards and backwards) can unlock ancient treasures. The Royal Wizard needs 
                        our knight duo to quickly verify if mysterious inscriptions are indeed magical palindromes.
                    </p>
                    <p style="font-size: 1.1em; color: #ffeb3b; margin-top: 15px;">
                        Legend says: "A true palindrome reflects perfectly in the mirror of logic!"
                    </p>
                </div>

                <div class="coding-challenge">
                    <h3>🔮 Coding Challenge: Palindrome Checker</h3>
                    <div class="problem-statement">
                        <strong>Problem:</strong> Determine if a given string is a palindrome using the two-pointers technique.
                        <br><br>
                        <strong>Examples:</strong>
                        <br>• "racecar" → true (magical! ✨)
                        <br>• "hello" → false (not magical 😔)
                        <br>• "A man a plan a canal Panama" → true (ignoring spaces & case)
                    </div>

                    <div class="interactive-demo">
                        <h3>🎮 Test the Magic Yourself!</h3>
                        <input type="text" id="palindrome-input" placeholder="Enter a word to test for magic..." style="width: 400px;">
                        <button class="btn primary" onclick="testPalindrome()">🔍 Test Magic</button>
                        <div id="palindrome-result" style="margin-top: 20px; font-size: 1.3em; min-height: 40px;"></div>
                    </div>

                    <button class="btn primary" onclick="showSolution('palindrome')">Show Algorithm & Analysis</button>
                    <div id="palindrome-solution" class="hidden">
                       <div class="code-block"><strong>Java</strong>
                        <pre>public static boolean isPalindrome(String s) {
                        String t = s.replaceAll("[^A-Za-z0-9]", "").toLowerCase();
                        int left = 0, right = t.length() - 1;
                        while (left &lt; right) {
                            if (t.charAt(left) != t.charAt(right)) return false;
                            left++; right--;
                        }
                        return true;
                        }</pre>
                        </div>
                        <div class="algorithm-step">
                            <strong>✨ The Magic Behind It:</strong>
                            <p>Our knights work from the outside in, comparing characters like checking a mirror. 
                            If any pair doesn't match, the spell is broken! If they meet in the middle without 
                            finding differences, the word is truly magical.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 8: Palindrome Visualization -->
        <div class="slide">
            <div class="content">
                <h2>🎭 Palindrome Magic in Action</h2>
                
                <div class="interactive-demo">
                    <h3>🪞 The Mirror Test Ceremony</h3>
                    <p style="font-size: 1.2em;">Testing the word: "<strong>racecar</strong>"</p>
                    
                    <div class="array-visualization" id="palindrome-demo">
                        <!-- Populated by JavaScript -->
                    </div>
                    
                    <div id="palindrome-narrative" style="font-size: 1.2em; margin: 25px 0; min-height: 80px; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                        🎭 The ceremony is about to begin! Watch as our knights perform the ancient mirror test.
                    </div>
                    
                    <button class="btn success" onclick="runPalindromeStory()">🪞 Start Mirror Test</button>
                    <button class="btn" onclick="resetPalindrome()">🔄 Reset</button>
                </div>

                <div class="brain-teaser">
                    <h3>🧩 Brain Teaser #2</h3>
                    <p style="font-size: 1.1em;">
                        Without running code, can you tell if "A Santa at NASA" is a palindrome?
                        (Hint: Ignore spaces, punctuation, and case!)
                    </p>
                    <div style="margin: 15px 0;">
                        <div class="quiz-option" onclick="checkAnswer('palindrome-yes', true)">✨ Yes, it's magical!</div>
                        <div class="quiz-option" onclick="checkAnswer('palindrome-no', false)">😔 No, it's not magical</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 9: Container With Most Water Story -->
        <div class="slide">
            <div class="content">
                <h2>💧 Challenge 3: The Great Reservoir</h2>
                
                <div class="story-box">
                    <h3>🏗️ The Royal Engineering Challenge</h3>
                    <p style="font-size: 1.3em; line-height: 1.6;">
                        The Kingdom faces a drought! The Royal Engineer must build the largest possible water 
                        reservoir using two of the existing walls. Each wall has a different height, and the 
                        reservoir's capacity depends on both the distance between walls and the height of the 
                        shorter wall (water would overflow from the shorter side).
                    </p>
                    <p style="font-size: 1.1em; color: #4fc3f7; margin-top: 15px;">
                        Our knight duo must help choose the optimal wall pair to save the kingdom! 🏰💧
                    </p>
                </div>

                <div class="coding-challenge">
                    <h3>🚰 Coding Challenge: Container With Most Water</h3>
                    <div class="problem-statement">
                        <strong>Problem:</strong> Given an array representing wall heights, find two walls that can contain the most water.
                        <br><br>
                        <strong>Formula:</strong> Water Area = min(height[left], height[right]) × distance
                        <br>
                        <strong>Input:</strong> heights = [1, 8, 6, 2, 5, 4, 8, 3, 7]
                        <br>
                        <strong>Goal:</strong> Find the maximum possible water area
                    </div>

                    <div class="hint-box">
                        <strong>🤔 Think Like an Engineer:</strong>
                        <p>Why would we ever move the pointer at the taller wall? The water level is always 
                        limited by the shorter wall, so we should try to find a taller replacement for the limiting wall!</p>
                        <button class="btn" onclick="showHint('container')">More Strategic Hints</button>
                        <div id="container-hints" class="hidden">
                            <ul style="text-align: left; margin: 10px 0;">
                                <li>🎯 Start with maximum distance (leftmost and rightmost walls)</li>
                                <li>📏 Always move the pointer at the shorter wall (why keep the limiting factor?)</li>
                                <li>💧 Keep track of the maximum area seen so far</li>
                                <li>🔄 Continue until pointers meet</li>
                            </ul>
                        </div>
                    </div>

                    <button class="btn primary" onclick="showSolution('container')">Show Engineering Solution</button>
                    <div id="container-solution" class="hidden">
                        <div class="code-block"><strong>Java</strong>
                        <pre>public static int maxArea(int[] height) {
                        int left = 0, right = height.length - 1, max = 0;
                        while (left &lt; right) {
                            int area = Math.min(height[left], height[right]) * (right - left);
                            if (area &gt; max) max = area;
                            if (height[left] &lt; height[right]) left++;
                            else right--;
                        }
                        return max;
                        }</pre>
                        </div>
                        <div class="algorithm-step">
                            <strong>🧠 The Engineering Insight:</strong>
                            <p>We always move the pointer at the shorter wall because the water level is limited 
                            by the shorter wall. By moving to potentially find a taller wall, we might increase 
                            the water capacity, even if we lose some distance.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 10: Pattern Recognition -->
        <div class="slide">
            <div class="content">
                <h2>🔍 Chapter 4: The Pattern Detective</h2>
                
                <div class="story-box">
                    <h3>🕵️‍♂️ Learning to See the Signs</h3>
                    <p style="font-size: 1.2em; line-height: 1.6;">
                        After many adventures, our knights developed the ability to instantly recognize when 
                        their technique would be most effective. They taught young apprentices the sacred art 
                        of <strong>"Pattern Recognition"</strong> - knowing when to deploy the Two Pointers technique.
                    </p>
                </div>

                <div class="comparison-table">
                    <div class="comparison-item" style="background: linear-gradient(135deg, rgba(76,175,80,0.3), rgba(76,175,80,0.1));">
                        <h3>✅ Perfect For Two Pointers</h3>
                        <ul style="text-align: left; font-size: 1.1em;">
                            <li>🔢 Sorted arrays</li>
                            <li>🎯 Finding pairs/triplets</li>
                            <li>🪞 Palindrome checking</li>
                            <li>📏 Subarray problems</li>
                            <li>🔄 Array reversal</li>
                            <li>💧 Container problems</li>
                        </ul>
                    </div>
                    <div class="comparison-item" style="background: linear-gradient(135deg, rgba(244,67,54,0.3), rgba(244,67,54,0.1));">
                        <h3>❌ Not Ideal For</h3>
                        <ul style="text-align: left; font-size: 1.1em;">
                            <li>🎲 Unsorted arrays</li>
                            <li>🌳 Tree/Graph traversal</li>
                            <li>🔍 Complex searching</li>
                            <li>📊 Statistical problems</li>
                            <li>🧮 Mathematical sequences</li>
                            <li>🎪 Dynamic programming</li>
                        </ul>
                    </div>
                    <div class="comparison-item" style="background: linear-gradient(135deg, rgba(255,235,59,0.3), rgba(255,235,59,0.1));">
                        <h3>🎯 Recognition Signals</h3>
                        <ul style="text-align: left; font-size: 1.1em;">
                            <li>📝 "Sorted array" mentioned</li>
                            <li>🔍 "Find two elements"</li>
                            <li>⚖️ "Target sum/condition"</li>
                            <li>🚀 "Optimize from O(n²)"</li>
                            <li>📊 "Linear time solution"</li>
                            <li>🎪 "In-place operations"</li>
                        </ul>
                    </div>
                </div>

                <div class="brain-teaser">
                    <h3>🎮 Pattern Recognition Game!</h3>
                    <p style="font-size: 1.1em;">Which of these problems would benefit from Two Pointers?</p>
                    <div class="quiz-option" onclick="checkPattern('A', true)">A) Find two numbers in sorted array that sum to target</div>
                    <div class="quiz-option" onclick="checkPattern('B', false)">B) Find the shortest path in a graph</div>
                    <div class="quiz-option" onclick="checkPattern('C', true)">C) Remove duplicates from sorted array</div>
                    <div class="quiz-option" onclick="checkPattern('D', false)">D) Calculate fibonacci numbers</div>
                </div>
            </div>
        </div>

        <!-- Slide 11: Advanced Challenge -->
        <div class="slide">
            <div class="content">
                <h2>🏆 Master Challenge: Three Sum Quest</h2>
                
                <div class="story-box">
                    <h3>⚔️ The Ultimate Trial</h3>
                    <p style="font-size: 1.2em; line-height: 1.6;">
                        The Guild of Master Programmers presents the ultimate challenge: instead of finding two 
                        numbers that sum to a target, find <strong>three numbers</strong> that sum to zero! 
                        This requires combining the Two Pointers technique with additional strategy.
                    </p>
                    <p style="color: #ffeb3b;">Can our heroes evolve their technique for this greater challenge?</p>
                </div>

                <div class="coding-challenge">
                    <h3>🎯 Advanced Challenge: Three Sum</h3>
                    <div class="problem-statement">
                        <strong>Problem:</strong> Given an array, find all unique triplets that sum to zero.
                        <br><br>
                        <strong>Input:</strong> nums = [-1, 0, 1, 2, -1, -4]
                        <br>
                        <strong>Output:</strong> [[-1, -1, 2], [-1, 0, 1]]
                        <br>
                        <strong>Challenge:</strong> No duplicate triplets allowed!
                    </div>

                    <div class="hint-box">
                        <strong>🧠 Master Strategy:</strong>
                        <p>Think of it as: fix one number, then use Two Pointers on the remaining array!</p>
                        <button class="btn" onclick="showHint('threesum')">Reveal Master Technique</button>
                        <div id="threesum-hints" class="hidden">
                            <ol style="text-align: left; margin: 10px 0;">
                                <li>🔄 Sort the array first</li>
                                <li>🎯 Fix the first number (outer loop)</li>
                                <li>⚔️ Use Two Pointers on the remaining subarray</li>
                                <li>🚫 Skip duplicates to avoid duplicate triplets</li>
                            </ol>
                        </div>
                    </div>

                    <button class="btn primary" onclick="showSolution('threesum')">Show Master Solution</button>
                    <div id="threesum-solution" class="hidden">
                        <div class="code-block"><strong>Java</strong>
                        <pre>public static  List&lt; List&lt;Integer&gt;&gt; threeSum(int[] nums) {
                         Arrays.sort(nums);
                         List&lt; List&lt;Integer&gt;&gt; res = new  ArrayList<>();
                        for (int i = 0; i &lt; nums.length - 2; i++) {
                            if (i &gt; 0 &amp;&amp; nums[i] == nums[i - 1]) continue;
                            int left = i + 1, right = nums.length - 1;
                            while (left &lt; right) {
                            int sum = nums[i] + nums[left] + nums[right];
                            if (sum == 0) {
                                res.add( Arrays.asList(nums[i], nums[left], nums[right]));
                                while (left &lt; right &amp;&amp; nums[left] == nums[left + 1]) left++;
                                while (left &lt; right &amp;&amp; nums[right] == nums[right - 1]) right--;
                                left++; right--;
                            } else if (sum &lt; 0) left++;
                            else right--;
                            }
                        }
                        return res;
                        }</pre>
                        </div>
                        <div class="algorithm-step">
                            <strong>⚔️ The Evolution:</strong>
                            <p>Our knights learned to work with a fixed anchor point! By fixing one number and applying 
                            Two Pointers to the rest, they transformed an O(n³) brute force problem into an O(n²) solution.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 12: Performance Analysis -->
        <div class="slide">
            <div class="content">
                <h2>📊 Chapter 5: The Performance Saga</h2>
                
                <div class="story-box">
                    <h3>⏱️ The Speed Chronicles</h3>
                    <p style="font-size: 1.2em; line-height: 1.6;">
                        The Royal Time Keeper was amazed by our heroes' efficiency. Let's understand the mathematical 
                        magic behind their lightning-fast solutions and compare them with traditional approaches.
                    </p>
                </div>

                <div class="comparison-table">
                    <div class="comparison-item">
                        <h3>🐌 Brute Force Approach</h3>
                        <p><strong>Time:</strong> O(n²)</p>
                        <p><strong>Space:</strong> O(1)</p>
                        <p><strong>Method:</strong> Check every pair</p>
                        <p style="color: #ff4444;">For 1000 elements: ~500,000 operations!</p>
                    </div>
                    <div class="comparison-item">
                        <h3>⚡ Two Pointers Magic</h3>
                        <p><strong>Time:</strong> O(n)</p>
                        <p><strong>Space:</strong> O(1)</p>
                        <p><strong>Method:</strong> Single intelligent pass</p>
                        <p style="color: #4caf50;">For 1000 elements: ~1000 operations!</p>
                    </div>
                    <div class="comparison-item">
                        <h3>🧠 Hash Table Alternative</h3>
                        <p><strong>Time:</strong> O(n)</p>
                        <p><strong>Space:</strong> O(n)</p>
                        <p><strong>Method:</strong> Store complements</p>
                        <p style="color: #ff9800;">Fast but uses extra memory</p>
                    </div>
                </div>

                <div class="brain-teaser">
                    <h3>🧮 Performance Quiz!</h3>
                    <p style="font-size: 1.1em;">
                        If an algorithm takes 1 second to process 1000 elements with O(n²) complexity, 
                        how long would Two Pointers (O(n)) take for the same data?
                    </p>
                    <div class="quiz-option" onclick="checkPerformance('A', false)">A) 0.5 seconds</div>
                    <div class="quiz-option" onclick="checkPerformance('B', true)">B) ~0.001 seconds (1ms)</div>
                    <div class="quiz-option" onclick="checkPerformance('C', false)">C) 0.1 seconds</div>
                    <div id="performance-explanation" class="hidden" style="margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <strong>Explanation:</strong> O(n²) does ~500,000 operations for 1000 elements (If the quadratic work is all distinct pairs, that’s ~n(n−1)/2 ≈ 499,500 checks for n=1000.
Linear work is ~1,000 checks → ratio ≈ 499.5× → 1000 ms ÷ 499.5 ≈ 2.0 ms. ✅) but practically it's even faster due to simpler operations.
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 13: Common Pitfalls -->
        <div class="slide">
            <div class="content">
                <h2>⚠️ Chapter 6: The Trap Chambers</h2>
                
                <div class="story-box">
                    <h3>🕳️ Learning from Near Defeats</h3>
                    <p style="font-size: 1.2em; line-height: 1.6;">
                        Even our experienced knights faced dangerous traps during their adventures. Learning from these 
                        near-defeats made them stronger. Let's explore the common pitfalls that even experienced programmers fall into!
                    </p>
                </div>

                <div class="comparison-table">
                    <div class="comparison-item" style="background: linear-gradient(135deg, rgba(244,67,54,0.3), rgba(244,67,54,0.1));">
                        <h3>🚫 Trap #1: Wrong Pointer Movement</h3>
                        <p><strong>Mistake:</strong> Moving both pointers randomly</p>
                        <p><strong>Fix:</strong> Always think: "Do I need a larger or smaller value?"</p>
                        <p><strong>Story:</strong> Sir Left moved right when he needed to go smaller - chaos ensued!</p>
                    </div>
                    <div class="comparison-item" style="background: linear-gradient(135deg, rgba(244,67,54,0.3), rgba(244,67,54,0.1));">
                        <h3>🌀 Trap #2: Infinite Loops</h3>
                        <p><strong>Mistake:</strong> Pointers not getting closer</p>
                        <p><strong>Fix:</strong> Ensure left++ or right-- in each iteration</p>
                        <p><strong>Story:</strong> The knights got stuck in a magical loop until they learned proper movement!</p>
                    </div>
                    <div class="comparison-item" style="background: linear-gradient(135deg, rgba(244,67,54,0.3), rgba(244,67,54,0.1));">
                        <h3>📍 Trap #3: Boundary Issues</h3>
                        <p><strong>Mistake:</strong> Using wrong loop condition</p>
                        <p><strong>Fix:</strong> Think carefully: left < right vs left <= right</p>
                        <p><strong>Story:</strong> Dame Right stepped out of bounds and fell into a digital void!</p>
                    </div>
                </div>

                <div class="brain-teaser">
                    <h3>🕵️‍♂️ Debug Detective Challenge!</h3>
                    <p style="font-size: 1.1em;">Spot the bug in this code:</p>
                    <div class="code-block" style="font-size: 1em;">
while (left <= right) {<br>
&nbsp;&nbsp;if (arr[left] + arr[right] === target) return true;<br>
&nbsp;&nbsp;else if (arr[left] + arr[right] < target) right--;<br>
&nbsp;&nbsp;else left++;<br>
}
                    </div>
                    <button class="btn primary" onclick="revealBug()">🔍 Reveal Bug</button>
                    <div id="bug-answer" class="hidden" style="margin-top: 15px;">
                        <div style="background: rgba(244,67,54,0.2); padding: 15px; border-radius: 10px;">
                            <strong>🐛 Bug Found:</strong> The pointer movements are swapped!<br>
                            When sum is too small, we should move <strong>left++</strong> (get larger value)<br>
                            When sum is too large, we should move <strong>right--</strong> (get smaller value)<br>
                            <strong>+15 points for debugging skills!</strong> 🎉
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 14: Practice Arena -->
        <div class="slide">
            <div class="content">
                <h2>🏟️ Chapter 7: The Practice Arena</h2>
                
                <div class="story-box">
                    <h3>⚔️ The Training Grounds</h3>
                    <p style="font-size: 1.2em; line-height: 1.6;">
                        Before graduating, apprentices must prove their mastery in the Practice Arena. Here, they face 
                        increasingly difficult challenges designed to test every aspect of the Two Pointers technique. 
                        Each victory unlocks greater coding powers!
                    </p>
                </div>

                <div class="coding-challenge">
                    <h3>🥉 Bronze Challenge: Remove Duplicates</h3>
                    <div class="problem-statement">
                        <strong>The Librarian's Dilemma:</strong> The Royal Library has books arranged by ID, but some IDs appear multiple times. 
                        Remove duplicates while keeping the first occurrence of each ID.
                        <br><br>
                        <strong>Input:</strong> [1, 1, 2, 2, 2, 3, 4, 4, 5]
                        <br>
                        <strong>Output:</strong> [1, 2, 3, 4, 5, _, _, _, _] (length = 5)
                        <br>
                        <strong>Constraint:</strong> Modify array in-place, return new length
                    </div>

                    <div class="hint-box">
                        <strong>🎯 Strategy Hint:</strong>
                        <p>Use two pointers with different purposes: one tracks unique positions, other scans for new values!</p>
                        <button class="btn" onclick="showHint('remove-dup')">Show Tactical Hints</button>
                        <div id="remove-dup-hints" class="hidden">
                            <ul style="text-align: left; margin: 10px 0;">
                                <li>🐌 <strong>slow</strong> pointer: tracks position to place next unique element</li>
                                <li>🏃‍♂️ <strong>fast</strong> pointer: scans through array looking for different elements</li>
                                <li>🔄 When fast finds a different element, copy it to slow position and advance slow</li>
                                <li>✅ Return slow + 1 as the length of unique elements</li>
                            </ul>
                        </div>
                    </div>

                    <button class="btn primary" onclick="showSolution('remove-dup')">Show Solution</button>
                    <div id="remove-dup-solution" class="hidden">
                        <div class="code-block"><strong>Java</strong>
                        <pre>public static int removeDuplicates(int[] nums) {
                        if (nums.length == 0) return 0;
                        int slow = 0;
                        for (int fast = 1; fast &lt; nums.length; fast++) {
                            if (nums[fast] != nums[slow]) {
                            nums[++slow] = nums[fast];
                            }
                        }
                        return slow + 1;
                        }</pre>
                        </div>
                        <div class="algorithm-step">
                            <strong>🧠 The Insight:</strong> This uses a variation where both pointers move in the same direction, 
                            but at different speeds based on conditions. It's like a race where one runner waits for 
                            interesting discoveries!
                        </div>
                    </div>
                </div>

                <div class="coding-challenge">
                    <h3>🥈 Silver Challenge: Valid Palindrome II</h3>
                    <div class="problem-statement">
                        <strong>The Forgiving Mirror:</strong> A magical mirror can ignore ONE character to determine if a string is a palindrome. 
                        Can you delete at most one character to make it palindromic?
                        <br><br>
                        <strong>Examples:</strong>
                        <br>• "aba" → true (already palindromic)
                        <br>• "abca" → true (remove 'c' to get "aba")
                        <br>• "abc" → false (can't be made palindromic by removing one character)
                    </div>

                    <button class="btn primary" onclick="showSolution('valid-palindrome-2')">Show Advanced Solution</button>
                    <div id="valid-palindrome-2-solution" class="hidden">
                        <div class="code-block"><strong>Java</strong>
                        <pre>public static boolean validPalindrome(String s) {
                        int l = 0, r = s.length() - 1;
                        while (l &lt; r) {
                            if (s.charAt(l) != s.charAt(r)) {
                            return isPalindromeRange(s, l + 1, r) || isPalindromeRange(s, l, r - 1);
                            }
                            l++; r--;
                        }
                        return true;
                        }
                        private static boolean isPalindromeRange(String s, int l, int r) {
                        while (l &lt; r) {
                            if (s.charAt(l++) != s.charAt(r--)) return false;
                        }
                        return true;
                        }</pre>
                        </div>
                        <div class="algorithm-step">
                            <strong>🎭 Advanced Strategy:</strong> When our knights encounter a mismatch, they explore both 
                            possibilities: skip the left character OR skip the right character. If either path leads to 
                            palindrome success, the mission is accomplished!
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 15: Real-World Applications -->
        <div class="slide">
            <div class="content">
                <h2>🌍 Chapter 8: Beyond the Kingdom</h2>
                
                <div class="story-box">
                    <h3>🚀 The Modern Quest</h3>
                    <p style="font-size: 1.2em; line-height: 1.6;">
                        Our knights' techniques transcended the medieval kingdom and found applications in the modern 
                        digital world. From DNA analysis to financial algorithms, the Two Pointers technique solves 
                        real-world problems every day!
                    </p>
                </div>

                <div class="comparison-table">
                    <div class="comparison-item">
                        <h3>🧬 Bioinformatics</h3>
                        <p><strong>Application:</strong> DNA sequence alignment</p>
                        <p><strong>Use:</strong> Finding complementary base pairs</p>
                        <p><strong>Impact:</strong> Faster genetic analysis</p>
                        <div class="emoji">🔬</div>
                    </div>
                    <div class="comparison-item">
                        <h3>💰 Finance</h3>
                        <p><strong>Application:</strong> Portfolio optimization</p>
                        <p><strong>Use:</strong> Finding asset pairs with target risk/return</p>
                        <p><strong>Impact:</strong> Real-time trading algorithms</p>
                        <div class="emoji">📈</div>
                    </div>
                    <div class="comparison-item">
                        <h3>🎮 Gaming</h3>
                        <p><strong>Application:</strong> Collision detection</p>
                        <p><strong>Use:</strong> Finding objects within distance ranges</p>
                        <p><strong>Impact:</strong> Smooth 60fps gameplay</p>
                        <div class="emoji">🎯</div>
                    </div>
                </div>

                <div class="story-box">
                    <h3>📱 Social Media Success Story</h3>
                    <p style="font-size: 1.1em; line-height: 1.5;">
                        A major social media company was struggling with their "People You May Know" feature. The original algorithm 
                        took several seconds to find mutual friends between users. By applying the Two Pointers technique on 
                        sorted friend lists, they reduced the processing time from 3 seconds to 50 milliseconds - a 60× improvement!
                    </p>
                    <p style="color: #4caf50; margin-top: 15px;">
                        <strong>Result:</strong> Happier users, lower server costs, and a more responsive platform! 🎉
                    </p>
                </div>

                <div class="brain-teaser">
                    <h3>🤔 Innovation Challenge!</h3>
                    <p style="font-size: 1.1em;">
                        Can you think of a real-world problem where Two Pointers might be useful? 
                        Consider scenarios involving sorted data and finding relationships between elements.
                    </p>
                    <textarea id="innovation-idea" placeholder="Describe your innovative Two Pointers application..." style="width: 90%; height: 100px; margin: 15px 0;"></textarea>
                    <br>
                    <button class="btn primary" onclick="shareInnovation()">💡 Share Your Innovation</button>
                    <div id="innovation-feedback" style="margin-top: 15px; font-size: 1.1em;"></div>
                </div>
            </div>
        </div>

        <!-- Slide 16: Master Template -->
        <div class="slide">
            <div class="content">
                <h2>📜 Chapter 9: The Sacred Scroll</h2>
                
                <div class="story-box">
                    <h3>✨ The Ultimate Template</h3>
                    <p style="font-size: 1.2em; line-height: 1.6;">
                        Before departing, our knights inscribed their wisdom on a sacred scroll - a universal template 
                        that can be adapted for any Two Pointers challenge. This template has solved thousands of problems 
                        across the programming realm!
                    </p>
                </div>

                <div class="code-block" style="font-size: 1.1em;">
                    <span style="color: #4fc3f7;">// 🏆 THE LEGENDARY TWO POINTERS TEMPLATE (Java)</span>
                    <pre>
                    public static int[] twoPointersTemplate(int[] arr, int condition) {
                        int left = 0;                      // start
                        int right = arr.length - 1;        // end

                        while (left &lt; right) {
                            // TODO 1: How to combine two values?
                            int current = /* e.g., arr[left] + arr[right] */;

                            // TODO 2: When is it a success?
                            if (/* e.g., current == condition */ false) {
                                return new int[]{ left, right };   // found
                            }

                            // TODO 3: Which way to move?
                            if (/* e.g., current &lt; condition */ false) {
                                left++;    // need bigger value
                            } else {
                                right--;   // need smaller value
                            }
                        }
                        return new int[]{ -1, -1 }; // not found
                    }
                    </pre>
                </div>
                <div class="algorithm-step">
                    <strong>🔧 Template Variations:</strong>
                    <ul style="text-align: left; margin: 10px 0; font-size: 1.1em;">
                        <li><strong>🎯 Two Sum:</strong> evaluate = sum, condition = target</li>
                        <li><strong>🪞 Palindrome:</strong> evaluate = character comparison, condition = equality</li>
                        <li><strong>💧 Container:</strong> evaluate = area calculation, condition = maximum</li>
                        <li><strong>🔄 Remove Duplicates:</strong> Same direction, different speeds</li>
                    </ul>
                </div>

                <div class="interactive-demo">
                    <h3>🎮 Template Customization Challenge!</h3>
                    <p>Try customizing the template for different problems:</p>
                    <button class="btn" onclick="showTemplateExample('twosum')">Two Sum Version</button>
                    <button class="btn" onclick="showTemplateExample('palindrome')">Palindrome Version</button>
                    <button class="btn" onclick="showTemplateExample('container')">Container Version</button>
                    <div id="template-example" style="margin-top: 20px; font-size: 1.1em; min-height: 50px;"></div>
                </div>
            </div>
        </div>

        <!-- Slide 17: Final Boss Challenge -->
        <div class="slide">
            <div class="content">
                <h2>👑 Final Boss: The Legendary Challenge</h2>
                
                <div class="story-box">
                    <h3>🐉 The Ultimate Trial</h3>
                    <p style="font-size: 1.3em; line-height: 1.6;">
                        The Ancient Dragon of Complexity guards the most treasured algorithmic secret. To claim victory, 
                        you must solve the legendary <strong>"Trapping Rain Water"</strong> problem - a challenge that has 
                        defeated many brave programmers. Only true masters can tame this algorithmic beast!
                    </p>
                </div>

                <div class="coding-challenge">
                    <h3>🌧️ Final Boss: Trapping Rain Water</h3>
                    <div class="problem-statement">
                        <strong>The Great Flood Challenge:</strong> Given an array representing elevation heights, 
                        calculate how much rainwater can be trapped after it rains.
                        <br><br>
                        <strong>Input:</strong> heights = [0,1,0,2,1,0,1,3,2,1,2,1]
                        <br>
                        <strong>Visual:</strong> Imagine bars of different heights, and water collecting in the valleys
                        <br>
                        <strong>Output:</strong> 6 units of trapped water
                    </div>

                    <div class="interactive-demo">
                        <h3>🧠 Think Like a Master</h3>
                        <div style="background: rgba(255,235,59,0.1); padding: 20px; border-radius: 10px; margin: 20px 0;">
                            <p style="font-size: 1.1em; line-height: 1.5;">
                                <strong>💭 Master's Insight:</strong> Water at any position is trapped based on the minimum of:
                                <br>• The highest bar to its left
                                <br>• The highest bar to its right
                                <br>• Minus its own height
                            </p>
                        </div>
                        
                        <button class="btn" onclick="showHint('rainwater')">🔍 Reveal Strategy</button>
                        <div id="rainwater-hints" class="hidden" style="margin-top: 15px;">
                            <div class="hint-box">
                                <strong>🎯 Two Pointers Strategy:</strong>
                                <ul style="text-align: left; margin: 10px 0;">
                                    <li>🏔️ Track the maximum height seen from left and right</li>
                                    <li>⚔️ Move the pointer with the smaller maximum height</li>
                                    <li>💧 Calculate trapped water at each position</li>
                                    <li>🧮 The key insight: we only need the minimum of left_max and right_max!</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <button class="btn primary" onclick="showSolution('rainwater')">🏆 Reveal Master Solution</button>
                    <div id="rainwater-solution" class="hidden">
                        <div class="code-block"><strong>Java</strong>
                        <pre>public static int trap(int[] height) {
                        if (height.length == 0) return 0;
                        int left = 0, right = height.length - 1;
                        int leftMax = 0, rightMax = 0, water = 0;
                        while (left &lt; right) {
                            if (height[left] &lt; height[right]) {
                            if (height[left] &gt;= leftMax) leftMax = height[left];
                            else water += leftMax - height[left];
                            left++;
                            } else {
                            if (height[right] &gt;= rightMax) rightMax = height[right];
                            else water += rightMax - height[right];
                            right--;
                            }
                        }
                        return water;
                        }</pre>
                        </div>
                        <div class="algorithm-step">
                            <strong>🐉 Dragon Defeated!</strong>
                            <p>By maintaining left and right maximums and always processing the side with the smaller maximum, 
                            we ensure we have enough "wall height" to calculate trapped water accurately. This transforms an 
                            O(n) space solution into an O(1) space masterpiece!</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #ffd700, #ffa500); color: #333; padding: 20px; border-radius: 15px; margin: 20px 0;">
                            <strong>🏆 LEGENDARY STATUS ACHIEVED! 🏆</strong>
                            <br>You've mastered the most challenging Two Pointers problem!
                            <br><strong>+100 points! You are now a Two Pointers Master! 👑</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 18: Graduation Ceremony -->
        <div class="slide">
            <div class="content">
                <h1>🎓 The Graduation Ceremony</h1>
                
                <div class="story-box">
                    <h3>👑 From Apprentice to Master</h3>
                    <p style="font-size: 1.4em; line-height: 1.6; text-align: center;">
                        Congratulations, brave apprentice! You have completed your journey through the mystical realm 
                        of Two Pointers. You've learned the ancient techniques, faced legendary challenges, and 
                        emerged as a true master of algorithmic problem-solving.
                    </p>
                </div>

                <div class="comparison-table">
                    <div class="comparison-item" style="background: linear-gradient(135deg, rgba(255,215,0,0.3), rgba(255,165,0,0.1));">
                        <h3>🎯 Skills Mastered</h3>
                        <ul style="text-align: left; font-size: 1.1em;">
                            <li>⚔️ Two Pointers technique</li>
                            <li>🧠 Pattern recognition</li>
                            <li>🐛 Debugging strategies</li>
                            <li>📊 Complexity analysis</li>
                            <li>🏗️ Template application</li>
                        </ul>
                    </div>
                    <div class="comparison-item" style="background: linear-gradient(135deg, rgba(76,175,80,0.3), rgba(139,195,74,0.1));">
                        <h3>🏆 Challenges Conquered</h3>
                        <ul style="text-align: left; font-size: 1.1em;">
                            <li>💰 Two Sum Mastery</li>
                            <li>🪞 Palindrome Magic</li>
                            <li>💧 Container Optimization</li>
                            <li>🧹 Array Cleanup</li>
                            <li>🌧️ Rainwater Trapping</li>
                        </ul>
                    </div>
                    <div class="comparison-item" style="background: linear-gradient(135deg, rgba(156,39,176,0.3), rgba(156,39,176,0.1));">
                        <h3>🚀 Ready for Next</h3>
                        <ul style="text-align: left; font-size: 1.1em;">
                            <li>📈 Advanced algorithms</li>
                            <li>🌳 Data structures</li>
                            <li>🎯 System design</li>
                            <li>💼 Technical interviews</li>
                            <li>🌍 Real-world projects</li>
                        </ul>
                    </div>
                </div>

                <div class="gamification-box">
                    <h2>🏅 Your Final Score</h2>
                    <p style="font-size: 1.5em; margin: 15px 0;">
                        <span id="final-score">Amazing!</span> 🎉
                    </p>
                    <p style="font-size: 1.2em;">
                        You've earned the title: <strong>"Two Pointers Grandmaster"</strong> 👑
                    </p>
                </div>

                <div class="story-box">
                    <h3>📜 The Master's Scroll</h3>
                    <p style="font-size: 1.2em; line-height: 1.6;">
                        "Remember, young master, the true power of Two Pointers lies not just in its efficiency, 
                        but in its elegance. You have learned to think systematically, move strategically, and 
                        solve problems with grace. These skills will serve you well in all your future coding adventures."
                    </p>
                    <p style="text-align: right; font-style: italic; margin-top: 20px; color: #ffeb3b;">
                        - Sir Left-Pointer & Dame Right-Pointer
                    </p>
                </div>
            </div>
        </div>

        <!-- Slide 19: The Adventure Continues -->
        <div class="slide">
            <div class="content">
                <h2>🌟 Chapter 10: The Adventure Continues</h2>
                
                <div class="story-box">
                    <h3>🚀 Your Quest Never Ends</h3>
                    <p style="font-size: 1.3em; line-height: 1.6;">
                        Every master was once a beginner. Every expert was once a novice. Your journey with Two Pointers 
                        is just the beginning of an incredible adventure in the world of algorithms and data structures.
                    </p>
                </div>

                <div class="comparison-table">
                    <div class="comparison-item">
                        <h3>📚 Keep Learning</h3>
                        <p><strong>Next Steps:</strong></p>
                        <ul style="text-align: left; font-size: 1.1em;">
                            <li>🔄 Sliding Window</li>
                            <li>🏃‍♂️ Fast & Slow Pointers</li>
                            <li>📊 Dynamic Programming</li>
                            <li>🌳 Tree Traversals</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <h3>💻 Keep Practicing</h3>
                        <p><strong>Platforms:</strong></p>
                        <ul style="text-align: left; font-size: 1.1em;">
                            <li>🎯 LeetCode</li>
                            <li>🏆 HackerRank</li>
                            <li>⚔️ CodeChef</li>
                            <li>🎮 Codeforces</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <h3>🤝 Keep Sharing</h3>
                        <p><strong>Community:</strong></p>
                        <ul style="text-align: left; font-size: 1.1em;">
                            <li>💬 Discuss solutions</li>
                            <li>👥 Help others learn</li>
                            <li>📝 Write tech blogs</li>
                            <li>🎤 Give tech talks</li>
                        </ul>
                    </div>
                </div>

                <div class="brain-teaser">
                    <h3>🎯 Your Personal Challenge</h3>
                    <p style="font-size: 1.2em; margin-bottom: 20px;">
                        Set a goal for yourself! What Two Pointers problem will you solve next?
                    </p>
                    <textarea id="personal-goal" placeholder="Write your next coding goal here..." style="width: 90%; height: 80px; margin: 15px 0;"></textarea>
                    <br>
                    <button class="btn primary" onclick="setPersonalGoal()">🎯 Set My Goal</button>
                    <div id="goal-response" style="margin-top: 15px; font-size: 1.1em;"></div>
                </div>

                <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 30px; border-radius: 20px; margin: 30px 0;">
                    <h3 style="color: #ffeb3b;">💎 Remember the Golden Rules:</h3>
                    <div style="font-size: 1.2em; line-height: 1.8; text-align: left;">
                        <p>1. 🎯 <strong>Pattern Recognition:</strong> Sorted array + find pairs = Two Pointers</p>
                        <p>2. 🧠 <strong>Smart Movement:</strong> Need bigger → move left right, need smaller → move right left</p>
                        <p>3. ⚡ <strong>Efficiency Master:</strong> O(n) time, O(1) space - elegant and fast</p>
                        <p>4. 🔄 <strong>Practice Makes Perfect:</strong> Draw examples, trace steps, then code</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 20: Q&A and Celebration -->
        <div class="slide">
            <div class="content">
                <h1>🎉 The Grand Finale!</h1>
                
                <div class="story-box">
                    <h2>🎭 Questions & Discussion</h2>
                    <p style="font-size: 1.4em; line-height: 1.6; margin: 30px 0;">
                        The kingdom celebrates your mastery! Now it's time to share wisdom, ask questions, 
                        and help each other grow. Remember: the best way to master something is to teach it to others!
                    </p>
                </div>

                <div class="interactive-demo">
                    <h3>🤔 Discussion Topics</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0;">
                        <div class="brain-teaser">
                            <h4>💭 For Curious Minds</h4>
                            <ul style="text-align: left; font-size: 1.1em;">
                                <li>What other problems remind you of Two Pointers?</li>
                                <li>How would you explain this to a friend?</li>
                                <li>What was your biggest "aha!" moment?</li>
                            </ul>
                        </div>
                        <div class="brain-teaser">
                            <h4>🚀 For Future Explorers</h4>
                            <ul style="text-align: left; font-size: 1.1em;">
                                <li>Which variation interests you most?</li>
                                <li>How might this apply to your projects?</li>
                                <li>What algorithm should we explore next?</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="gamification-box">
                    <h3>🏆 Class Champions</h3>
                    <p style="font-size: 1.2em;">
                        Share your most creative Two Pointers application idea!
                        <br>The most innovative solution wins the "Algorithm Innovation Award!" 🥇
                    </p>
                    <button class="btn primary" onclick="openInnovationPortal()">💡 Submit Innovation</button>
                </div>

                <div style="text-align: center; margin-top: 50px;">
                    <div style="font-size: 3em; margin: 20px 0;">🎊🎉🎊</div>
                    <h2 style="color: #ffeb3b;">Thank You for This Amazing Journey!</h2>
                    <p style="font-size: 1.3em; margin: 20px 0;">
                        You've proven that learning algorithms can be fun, engaging, and memorable!
                    </p>
                    <div style="font-size: 2em; margin: 20px 0;">
                        🚀 Go forth and code with confidence! 🚀
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,165,0,0.1)); padding: 25px; border-radius: 15px; margin: 30px 0;">
                    <p style="font-size: 1.2em; font-style: italic;">
                        "The journey of a thousand algorithms begins with a single pointer." 
                        <br>- Ancient Programming Proverb
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="btn" onclick="prevSlide()">◀ Previous</button>
        <button class="btn" onclick="nextSlide()">Next ▶</button>
    </div>

    <div class="slide-counter">
        <span id="slide-number">1</span> / 20
    </div>

    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const totalSlides = slides.length;
        
        // Enhanced Scoring System
        let players = {}; // {name: {score: number, activities: Set}}
        let completedActivities = new Set(); // Track global activity completion
        let hostMode = false;
        let pendingScore = null; // For host approval
        
        // Demo states
        let heroStep = 0;
        let twoSumStep = 0;
        let palindromeStep = 0;

        function showSlide(n) {
            slides[currentSlide].classList.remove('active');
            currentSlide = (n + totalSlides) % totalSlides;
            slides[currentSlide].classList.add('active');
            document.getElementById('slide-number').textContent = currentSlide + 1;
            
            // Update progress
            const progress = ((currentSlide + 1) / totalSlides) * 100;
            document.getElementById('quest-progress').style.width = progress + '%';
            
            // Show winner on final slide
            if (currentSlide === totalSlides - 1) {
                showFinalResults();
            }
        }

        function nextSlide() {
            showSlide(currentSlide + 1);
        }

        function prevSlide() {
            showSlide(currentSlide - 1);
        }

        // Enhanced Scoring Functions
        function awardPoints(activityId, points, message = "Great job!") {
            // Check if activity already completed
            if (completedActivities.has(activityId)) {
                showMessage("Activity already completed! ✅", "#ff9800");
                return;
            }
            
            pendingScore = {
                activityId: activityId,
                points: points,
                message: message
            };
            
            document.getElementById('modal-message').textContent = `${message} You earned ${points} points!`;
            
            if (hostMode) {
                document.getElementById('host-approval').style.display = 'block';
            } else {
                document.getElementById('host-approval').style.display = 'none';
            }
            
            document.getElementById('nameModal').style.display = 'block';
        }

        function submitScore() {
            const name = document.getElementById('player-name').value.trim();
            
            if (!name) {
                alert('Please enter your name!');
                return;
            }

            if (hostMode) {
                // Wait for host approval
                pendingScore.playerName = name;
                showMessage("Waiting for host approval...", "#ff9800");
                return;
            }
            
            processScore(name);
        }

        function processScore(name) {
            if (!pendingScore) return;
            
            // Initialize player if new
            if (!players[name]) {
                players[name] = {
                    score: 0,
                    activities: new Set()
                };
            }
            
            // Add points and mark activity as completed
            players[name].score += pendingScore.points;
            players[name].activities.add(pendingScore.activityId);
            completedActivities.add(pendingScore.activityId);
            
            // Mark button as completed
            markActivityCompleted(pendingScore.activityId);
            
            updateLeaderboardDisplay();
            closeModal();
            
            showMessage(`${name} earned ${pendingScore.points} points! 🎉`, "#4caf50");
            pendingScore = null;
        }

        function approveScore() {
            if (pendingScore && pendingScore.playerName) {
                processScore(pendingScore.playerName);
            }
        }

        function denyScore() {
            showMessage("Host denied the points", "#ff4444");
            closeModal();
            pendingScore = null;
        }

        function markActivityCompleted(activityId) {
            // Find and mark buttons/elements with this activity ID
            const elements = document.querySelectorAll(`[onclick*="${activityId}"]`);
            elements.forEach(el => {
                el.classList.add('activity-completed');
            });
        }

        function closeModal() {
            document.getElementById('nameModal').style.display = 'none';
            document.getElementById('player-name').value = '';
            pendingScore = null;
        }

        function showMessage(text, color) {
            const messageDiv = document.createElement('div');
            messageDiv.textContent = text;
            messageDiv.style.cssText = `
                position: fixed;
                top: 50px;
                left: 50%;
                transform: translateX(-50%);
                background: ${color};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                font-weight: bold;
                z-index: 1001;
                animation: fadeInOut 3s ease-in-out;
            `;
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                document.body.removeChild(messageDiv);
            }, 3000);
        }

        // Leaderboard Functions
        function updateLeaderboardDisplay() {
            // guard against undefined globals
            const p = (typeof players === 'object' && players) ? players : {};

            // compute stats safely
            const scores = Object.values(p).map(x => (x && typeof x.score === 'number') ? x.score : 0);
            const topScore = scores.length ? Math.max(0, ...scores) : 0;
            const playerCount = Object.keys(p).length;

            // update only if elements exist
            const topEl = document.getElementById('top-score');
            const countEl = document.getElementById('player-count');
            if (topEl)   topEl.textContent = String(topScore);
            if (countEl) countEl.textContent = String(playerCount);
        }


        function showLeaderboard() {
            const leaderboard = Object.entries(players)
                .sort(([,a], [,b]) => b.score - a.score)
                .map(([name, data], index) => {
                    const rank = index + 1;
                    let rankClass = '';
                    let emoji = '';
                    
                    if (rank === 1) { rankClass = 'first'; emoji = '🥇'; }
                    else if (rank === 2) { rankClass = 'second'; emoji = '🥈'; }
                    else if (rank === 3) { rankClass = 'third'; emoji = '🥉'; }
                    else { emoji = `${rank}.`; }
                    
                    return `
                        <div class="leaderboard-entry ${rankClass}">
                            <span>${emoji} ${name}</span>
                            <span>${data.score} points</span>
                        </div>
                    `;
                }).join('');

            document.getElementById('leaderboard-content').innerHTML = `
                <div class="leaderboard">
                    ${leaderboard || '<p style="text-align: center; color: #999;">No players yet! Start earning points to appear on the leaderboard.</p>'}
                </div>
            `;
            
            document.getElementById('leaderboardModal').style.display = 'block';
        }

        function closeLeaderboard() {
            document.getElementById('leaderboardModal').style.display = 'none';
        }

        function showFinalResults() {
            if (Object.keys(players).length === 0) return;
            
            const winner = Object.entries(players)
                .sort(([,a], [,b]) => b.score - a.score)[0];
            
            const finalScoreEl = document.getElementById('final-score');
            if (finalScoreEl && winner) {
                finalScoreEl.innerHTML = `
                    🏆 <strong>Champion: ${winner[0]}</strong> 🏆<br>
                    Final Score: ${winner[1].score} points<br>
                    <span style="font-size: 0.9em;">Congratulations on mastering Two Pointers!</span>
                `;
            }
        }

        // Host Control Functions
        function toggleHostMode() {
            hostMode = !hostMode;
            const button = document.getElementById('host-toggle');
            const controls = document.getElementById('host-controls');
            
            if (hostMode) {
                button.textContent = 'Disable Host Mode';
                button.style.background = 'linear-gradient(135deg, #f44336, #d32f2f)';
                controls.style.display = 'block';
            } else {
                button.textContent = 'Enable Host Mode';
                button.style.background = 'linear-gradient(135deg, #4caf50, #388e3c)';
                controls.style.display = 'none';
            }
        }

        function resetAllScores() {
            if (confirm('Are you sure you want to reset all scores and activities?')) {
                players = {};
                completedActivities.clear();
                updateLeaderboardDisplay();
                
                // Remove completed markers
                document.querySelectorAll('.activity-completed').forEach(el => {
                    el.classList.remove('activity-completed');
                });
                
                showMessage('All scores and activities reset!', '#ff6b6b');
            }
        }

        function showClassStats() {
            const totalPlayers = Object.keys(players).length;
            const totalActivities = completedActivities.size;
            const avgScore = totalPlayers > 0 
                ? Math.round(Object.values(players).reduce((sum, p) => sum + p.score, 0) / totalPlayers)
                : 0;
            
            alert(`📊 Class Statistics:\n\n👥 Total Players: ${totalPlayers}\n🎯 Activities Completed: ${totalActivities}\n📈 Average Score: ${avgScore} points\n🏆 Most Active: ${totalPlayers > 0 ? Object.entries(players).sort(([,a], [,b]) => b.score - a.score)[0][0] : 'None yet'}`);
        }

        // Updated Activity Functions with Scoring
        function revealAnswer(questionNum) {
            const activityId = `answer-${questionNum}`;
            document.getElementById(`answer${questionNum}`).classList.remove('hidden');
            awardPoints(activityId, 10, `Correct answer to Brain Teaser #${questionNum}!`);
        }

        function revealBug() {
            const activityId = 'debug-challenge';
            document.getElementById('bug-answer').classList.remove('hidden');
            awardPoints(activityId, 15, 'Excellent debugging skills!');
        }

        // Quiz functions with enhanced scoring
        function checkAnswer(option, isCorrect, quizId = 'general-quiz') {
            const activityId = `quiz-${quizId}-${option}`;
            
            const allOptions = document.querySelectorAll('.quiz-option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
                if (opt.textContent.startsWith(option.charAt(0))) {
                    opt.classList.add(isCorrect ? 'correct' : 'incorrect');
                }
            });
            
            if (isCorrect) {
                awardPoints(activityId, 15, `Correct answer to quiz question!`);
            } else {
                showMessage('Not quite right, but keep learning! 🤔', '#ff9800');
            }
        }

        function checkPattern(option, isCorrect) {
            checkAnswer(option, isCorrect, 'pattern-recognition');
        }

        function checkPerformance(option, isCorrect) {
            if (isCorrect) {
                document.getElementById('performance-explanation').classList.remove('hidden');
            }
            checkAnswer(option, isCorrect, 'performance-analysis');
        }

        // Demo functions with scoring
        function startHeroDemo() {
            const activityId = 'hero-demo';
            const container = document.getElementById('hero-demo');
            const narrative = document.getElementById('hero-narrative');
            const elements = container.children;
            
            // Reset
            for (let el of elements) {
                el.className = 'array-element';
            }
            
            heroStep = 0;
            
            function animateStep() {
                if (heroStep === 0) {
                    elements[0].className = 'array-element pointer-left';
                    elements[0].innerHTML = '2<div class="pointer-label">👈 Sir Left</div>';
                    elements[3].className = 'array-element pointer-right';
                    elements[3].innerHTML = '15<div class="pointer-label">Dame Right 👉</div>';
                    narrative.innerHTML = '🎬 <strong>Step 1:</strong> Sir Left (2) + Dame Right (15) = 17. Too big! Dame Right retreats...';
                    heroStep++;
                    setTimeout(animateStep, 2500);
                } else if (heroStep === 1) {
                    elements[3].className = 'array-element';
                    elements[3].innerHTML = '15';
                    elements[1].className = 'array-element pointer-right';
                    elements[1].innerHTML = '7<div class="pointer-label">Dame Right 👉</div>';
                    narrative.innerHTML = '🎉 <strong>Step 2:</strong> Sir Left (2) + Dame Right (7) = 9. Perfect! Victory achieved in just 2 steps!';
                    awardPoints(activityId, 20, 'Watched the legendary technique demonstration!');
                }
            }
            
            animateStep();
        }

        function runTwoSumStory() {
            const activityId = 'two-sum-demo';
            const container = document.getElementById('two-sum-demo');
            const narrative = document.getElementById('step-narrative');
            const array = [2, 7, 11, 15];
            
            container.innerHTML = '';
            array.forEach((num, index) => {
                const element = document.createElement('div');
                element.className = 'array-element';
                element.textContent = num;
                element.id = `demo-element-${index}`;
                container.appendChild(element);
            });

            let left = 0, right = 3;
            twoSumStep = 0;

            function nextStep() {
                if (twoSumStep === 0) {
                    document.getElementById(`demo-element-${left}`).className = 'array-element pointer-left';
                    document.getElementById(`demo-element-${left}`).innerHTML = `${array[left]}<div class="pointer-label">👈 Sir Left</div>`;
                    document.getElementById(`demo-element-${right}`).className = 'array-element pointer-right';
                    document.getElementById(`demo-element-${right}`).innerHTML = `${array[right]}<div class="pointer-label">Dame Right 👉</div>`;
                    narrative.innerHTML = `⚔️ <strong>Battle Plan:</strong> Sir Left guards position ${left} (value: ${array[left]}), Dame Right guards position ${right} (value: ${array[right]}). Combined force: ${array[left] + array[right]}. Target needed: 9. Assessment: Too powerful! Dame Right must retreat to weaken the sum.`;
                    twoSumStep++;
                } else if (twoSumStep === 1) {
                    document.getElementById(`demo-element-${right}`).className = 'array-element';
                    document.getElementById(`demo-element-${right}`).innerHTML = array[right];
                    right = 1;
                    document.getElementById(`demo-element-${right}`).className = 'array-element pointer-right';
                    document.getElementById(`demo-element-${right}`).innerHTML = `${array[right]}<div class="pointer-label">Dame Right 👉</div>`;
                    narrative.innerHTML = `🎉 <strong>VICTORY!</strong> Sir Left (${array[left]}) + Dame Right (${array[right]}) = ${array[left] + array[right]}. Perfect match for target 9! The treasure chest unlocks at positions [${left}, ${right}]. Our heroes celebrate another successful quest!`;
                    awardPoints(activityId, 25, 'Witnessed the Two Sum adventure!');
                    twoSumStep++;
                }
            }

            nextStep();
            setTimeout(nextStep, 3000);
        }

        function nextDemoStep() {
            // Manual step through for interactive learning
            if (twoSumStep < 2) {
                runTwoSumStory();
            }
        }

        function resetDemo() {
            document.getElementById('two-sum-demo').innerHTML = '';
            document.getElementById('step-narrative').textContent = '🎬 Ready for the show! Our knights are prepared to demonstrate their legendary technique.';
            twoSumStep = 0;
        }

        function checkStudentAnswer() {
            const activityId = 'student-practice';
            const answer = document.getElementById('student-answer').value.trim();
            const feedback = document.getElementById('student-feedback');
            
            if (answer === '1,3' || answer === '1, 3' || answer === '3,1' || answer === '3, 1') {
                feedback.innerHTML = '🎉 <strong>Brilliant!</strong> You found it! Positions 1 and 3 contain values 2 and 4, which sum to exactly 6. You\'re thinking like a true Two Pointers master!';
                feedback.style.color = '#4caf50';
                awardPoints(activityId, 20, 'Solved the practice problem correctly!');
            } else if (answer === '0,3' || answer === '0, 3' || answer === '3,0' || answer === '3, 0') {
                feedback.innerHTML = '🤔 Close! Positions 0 and 3 contain values 1 and 6, which sum to 7. We need exactly 6. Try positions 1 and 3!';
                feedback.style.color = '#ff9800';
            } else {
                feedback.innerHTML = '🤔 Not quite! Remember: we need two numbers that add up to 6. Think about which positions in [1, 2, 3, 4, 6] contain values that sum to 6. Try again!';
                feedback.style.color = '#ff4444';
            }
        }

        function testPalindrome() {
            const activityId = 'palindrome-test';
            const input = document.getElementById('palindrome-input').value.trim();
            const result = document.getElementById('palindrome-result');
            
            if (!input) {
                result.textContent = 'Please enter a word to test for magical properties! 🪄';
                result.style.color = '#ffeb3b';
                return;
            }

            // Simple palindrome check
            const cleaned = input.toLowerCase().replace(/[^a-z0-9]/g, '');
            let left = 0, right = cleaned.length - 1;
            let isPalindrome = true;
            
            while (left < right) {
                if (cleaned[left] !== cleaned[right]) {
                    isPalindrome = false;
                    break;
                }
                left++;
                right--;
            }

            if (isPalindrome) {
                result.innerHTML = `✨ <strong>"${input}" is MAGICAL!</strong> ✨<br>It reads the same forwards and backwards! The Mirror Kingdom approves! 🪞👑`;
                result.style.color = '#4caf50';
                awardPoints(activityId, 15, 'Discovered magical palindrome properties!');
            } else {
                result.innerHTML = `😔 <strong>"${input}" is not magical...</strong><br>It doesn't read the same forwards and backwards. But keep searching for palindromes! 🔍`;
                result.style.color = '#ff4444';
            }
        }

        function runPalindromeStory() {
            const activityId = 'palindrome-demo';
            const word = "racecar";
            const container = document.getElementById('palindrome-demo');
            const narrative = document.getElementById('palindrome-narrative');
            
            container.innerHTML = '';
            for (let i = 0; i < word.length; i++) {
                const element = document.createElement('div');
                element.className = 'array-element';
                element.textContent = word[i];
                element.id = `char-${i}`;
                container.appendChild(element);
            }

            let left = 0, right = word.length - 1;
            palindromeStep = 0;

            function animateStep() {
                // Reset colors
                for (let i = 0; i < word.length; i++) {
                    document.getElementById(`char-${i}`).className = 'array-element';
                }

                if (palindromeStep === 0) {
                    document.getElementById(`char-${left}`).className = 'array-element pointer-left';
                    document.getElementById(`char-${left}`).innerHTML = `${word[left]}<div class="pointer-label">👈 Sir Left</div>`;
                    document.getElementById(`char-${right}`).className = 'array-element pointer-right';
                    document.getElementById(`char-${right}`).innerHTML = `${word[right]}<div class="pointer-label">Dame Right 👉</div>`;
                    narrative.innerHTML = `🪞 <strong>Mirror Test Step ${palindromeStep + 1}:</strong> Sir Left sees '${word[left]}', Dame Right sees '${word[right]}'. Perfect mirror reflection! ✨ The ceremony continues...`;
                    left++; right--; palindromeStep++;
                    setTimeout(animateStep, 2000);
                } else if (palindromeStep === 1) {
                    document.getElementById(`char-${left}`).className = 'array-element pointer-left';
                    document.getElementById(`char-${left}`).innerHTML = `${word[left]}<div class="pointer-label">👈</div>`;
                    document.getElementById(`char-${right}`).className = 'array-element pointer-right';
                    document.getElementById(`char-${right}`).innerHTML = `${word[right]}<div class="pointer-label">👉</div>`;
                    narrative.innerHTML = `🪞 <strong>Mirror Test Step ${palindromeStep + 1}:</strong> Sir Left sees '${word[left]}', Dame Right sees '${word[right]}'. Another perfect match! ✨ The magic grows stronger...`;
                    left++; right--; palindromeStep++;
                    setTimeout(animateStep, 2000);
                } else if (palindromeStep === 2) {
                    document.getElementById(`char-${left}`).className = 'array-element pointer-left';
                    document.getElementById(`char-${left}`).innerHTML = `${word[left]}<div class="pointer-label">👈</div>`;
                    document.getElementById(`char-${right}`).className = 'array-element pointer-right';
                    document.getElementById(`char-${right}`).innerHTML = `${word[right]}<div class="pointer-label">👉</div>`;
                    narrative.innerHTML = `🪞 <strong>Mirror Test Step ${palindromeStep + 1}:</strong> Sir Left sees '${word[left]}', Dame Right sees '${word[right]}'. Perfect reflection again! ✨ One more step to complete the ritual...`;
                    left++; right--; palindromeStep++;
                    setTimeout(animateStep, 2000);
                } else {
                    document.getElementById(`char-3`).className = 'array-element both-pointers';
                    document.getElementById(`char-3`).innerHTML = `${word[3]}<div class="pointer-label">👑 Center</div>`;
                    narrative.innerHTML = `🎉 <strong>MAGICAL CONFIRMED!</strong> Our knights have met at the center! Every mirror test passed perfectly. The word "racecar" is truly enchanted! ✨👑 The Mirror Kingdom celebrates!`;
                    awardPoints(activityId, 30, 'Witnessed the ancient mirror ceremony!');
                }
            }

            animateStep();
        }

        function resetPalindrome() {
            document.getElementById('palindrome-demo').innerHTML = '';
            document.getElementById('palindrome-narrative').textContent = '🎭 The ceremony is about to begin! Watch as our knights perform the ancient mirror test.';
            palindromeStep = 0;
        }

        // Hint and solution functions with scoring
        function showHint(problem) {
            const activityId = `hint-${problem}`;
            document.getElementById(`${problem}-hints`).classList.remove('hidden');
            awardPoints(activityId, 5, 'Used hint for better understanding!');
        }

        function showSolution(problem) {
            const activityId = `solution-${problem}`;
            document.getElementById(`${problem}-solution`).classList.remove('hidden');
            awardPoints(activityId, 10, `Viewed ${problem} solution!`);
        }

        function showTemplateExample(type) {
  const activityId = `template-${type}`;
  const container = document.getElementById('template-example');
  if (!container) return;

  let html = '';
  if (type === 'twosum') {
    html = `
<div class="code-block"><strong>Java • Two Sum (sorted)</strong>
<pre>public static int[] twoSumSorted(int[] nums, int target) {
  int left = 0, right = nums.length - 1;
  while (left &lt; right) {
    int sum = nums[left] + nums[right];
    if (sum == target) return new int[]{left, right};
    if (sum &lt; target) left++;
    else right--;
  }
  return new int[]{-1, -1};
}</pre>
</div>`;
  } else if (type === 'palindrome') {
    html = `
<div class="code-block"><strong>Java • Palindrome</strong>
<pre>public static boolean isPalindrome(String s) {
  String t = s.replaceAll("[^A-Za-z0-9]", "").toLowerCase();
  int left = 0, right = t.length() - 1;
  while (left &lt; right) {
    if (t.charAt(left) != t.charAt(right)) return false;
    left++; right--;
  }
  return true;
}</pre>
</div>`;
  } else if (type === 'container') {
    html = `
<div class="code-block"><strong>Java • Container With Most Water</strong>
<pre>public static int maxArea(int[] height) {
  int left = 0, right = height.length - 1, max = 0;
  while (left &lt; right) {
    int area = Math.min(height[left], height[right]) * (right - left);
    if (area &gt; max) max = area;
    if (height[left] &lt; height[right]) left++;
    else right--;
  }
  return max;
}</pre>
</div>`;
  }

  container.innerHTML = html;
  if (typeof awardPoints === 'function') {
    awardPoints(activityId, 5, 'Explored \${type} template customization!');
  }
}

        function shareInnovation() {
            const activityId = 'innovation-sharing';
            const idea = document.getElementById('innovation-idea').value.trim();
            const feedback = document.getElementById('innovation-feedback');
            
            if (idea.length < 20) {
                feedback.innerHTML = '💭 Tell us more! Describe your idea in detail (at least 20 characters).';
                feedback.style.color = '#ff9800';
                return;
            }
            
            feedback.innerHTML = '🌟 <strong>Brilliant innovation!</strong> Your creative thinking shows true mastery of the Two Pointers concept. Keep exploring and pushing boundaries!';
            feedback.style.color = '#4caf50';
            awardPoints(activityId, 25, 'Shared innovative Two Pointers application!');
        }

        function setPersonalGoal() {
            const activityId = 'goal-setting';
            const goal = document.getElementById('personal-goal').value.trim();
            const response = document.getElementById('goal-response');
            
            if (goal.length < 10) {
                response.innerHTML = '🎯 Please set a specific, meaningful goal for your coding journey!';
                response.style.color = '#ff9800';
                return;
            }
            
            response.innerHTML = `🎉 <strong>Goal Set!</strong> Your commitment to "${goal}" shows the spirit of a true algorithm master. We believe in your success!`;
            response.style.color = '#4caf50';
            awardPoints(activityId, 20, 'Set personal coding goal!');
        }

        function openInnovationPortal() {
            const activityId = 'innovation-portal';
            alert('🎊 Innovation Portal Opened! 🎊\n\nShare your creative Two Pointers applications with the class!\n\nRemember: The best innovations often come from combining simple concepts in unexpected ways. Think about:\n• Real-world scenarios\n• Gaming applications  \n• Data processing challenges\n• User interface problems\n\nLet your creativity shine! 🌟');
            awardPoints(activityId, 10, 'Accessed the Innovation Portal!');
        }

        // Host Control Functions
        function toggleHostMode() {
            hostMode = !hostMode;
            const button = document.getElementById('host-toggle');
            const controls = document.getElementById('host-controls');
            
            if (hostMode) {
                button.textContent = 'Disable Host Mode';
                button.style.background = 'linear-gradient(135deg, #f44336, #d32f2f)';
                controls.style.display = 'block';
                showMessage('Host mode enabled - all scoring requires approval! 🎓', '#ff6b6b');
            } else {
                button.textContent = 'Enable Host Mode';
                button.style.background = 'linear-gradient(135deg, #4caf50, #388e3c)';
                controls.style.display = 'none';
                showMessage('Host mode disabled - automatic scoring enabled! ⚡', '#4caf50');
            }
        }

        function resetAllScores() {
            if (confirm('⚠️ Are you sure you want to reset all scores and activities?\n\nThis will:\n• Clear all player scores\n• Reset all completed activities\n• Remove all leaderboard entries\n\nThis action cannot be undone!')) {
                players = {};
                completedActivities.clear();
                updateLeaderboardDisplay();
                
                // Remove completed markers
                document.querySelectorAll('.activity-completed').forEach(el => {
                    el.classList.remove('activity-completed');
                });
                
                showMessage('🔄 All scores and activities have been reset!', '#ff6b6b');
                
                // Log the reset for transparency
                console.log(`[${new Date().toLocaleString()}] Host reset all scores and activities`);
            }
        }

        function showClassStats() {
            const totalPlayers = Object.keys(players).length;
            const totalActivities = completedActivities.size;
            const totalPossiblePoints = 300; // Estimated based on all activities
            const avgScore = totalPlayers > 0 
                ? Math.round(Object.values(players).reduce((sum, p) => sum + p.score, 0) / totalPlayers)
                : 0;
            
            const mostActive = totalPlayers > 0 
                ? Object.entries(players).sort(([,a], [,b]) => b.activities.size - a.activities.size)[0]
                : null;
                
            const highestScore = totalPlayers > 0
                ? Object.entries(players).sort(([,a], [,b]) => b.score - a.score)[0]
                : null;
            
            const engagementRate = totalActivities > 0 ? Math.round((totalActivities / 20) * 100) : 0;
            
            alert(`📊 Class Performance Analytics\n` +
                  `==============================\n\n` +
                  `👥 Participation:\n` +
                  `   • Total Players: ${totalPlayers}\n` +
                  `   • Activities Completed: ${totalActivities}/20 (${engagementRate}%)\n\n` +
                  `🏆 Performance:\n` +
                  `   • Average Score: ${avgScore} points\n` +
                  `   • Highest Score: ${highestScore ? `${highestScore[1].score} pts (${highestScore[0]})` : 'None yet'}\n` +
                  `   • Most Active: ${mostActive ? `${mostActive[0]} (${mostActive[1].activities.size} activities)` : 'None yet'}\n\n` +
                  `📈 Engagement Level: ${engagementRate < 30 ? '🔴 Low' : engagementRate < 70 ? '🟡 Medium' : '🟢 High'}\n\n` +
                  `💡 Suggestions:\n` +
                  `${engagementRate < 50 ? '   • Consider more interactive activities\n   • Encourage participation with bonus points\n' : '   • Great engagement! Keep it up!\n'}` +
                  `   • Use leaderboard to motivate students\n` +
                  `   • Celebrate achievements publicly`);
        }

        // Close modals when clicking outside or ESC key
        window.onclick = function(event) {
            const nameModal = document.getElementById('quickScoreModal');
            const leaderboardModal = document.getElementById('leaderboardModal');
            const answerModal = document.getElementById('answerModal');
            
            if (event.target === nameModal) {
                closeQuickModal();
            }
            if (event.target === leaderboardModal) {
                closeLeaderboard();
            }
            if (event.target === answerModal) {
                closeAnswerModal();
            }
        }

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                // Close any open modals
                closeQuickModal();
                closeLeaderboard();
                closeAnswerModal();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextSlide();
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                prevSlide();
            }
        });

        // Add CSS animation for messages
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInOut {
                0% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
                15% { opacity: 1; transform: translateX(-50%) translateY(0); }
                85% { opacity: 1; transform: translateX(-50%) translateY(0); }
                100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            }
        `;
        document.head.appendChild(style);

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateLeaderboardDisplay();
            
            // Add helpful console logs for debugging
            console.log('🎮 Two Pointers Adventure initialized!');
            console.log('📊 Scoring system: Dual-modal (Quick + Question-based)');
            console.log('🎓 Host controls available in top-right corner');
            
            // Show welcome message to host
            setTimeout(() => {
                showMessage('🎉 Two Pointers Adventure is ready! Enable host mode to control scoring.', '#4fc3f7');
            }, 2000);
        });
    </script>

    <script>
/* =========================
   Chapter/Slide Counter (no page count)
   + Always-visible "Add winners" button
   + Map-based Leaderboard with de-dupe
   ========================= */
(function(){
  "use strict";

  /* -----------------------
     Utilities
  ----------------------- */
  const $  = (s, r=document)=>r.querySelector(s);
  const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));
  const byId = (id)=>document.getElementById(id);
  const now = ()=>Date.now();
  const slug = s => (s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'');

  // Ensure global player state exists (compat with your earlier script)
  window.players = window.players || {};
  window.completedActivities = window.completedActivities || new Set();

  /* -----------------------
     1) Chapter index + counter UI (no "pages")
  ----------------------- */
  function isChapterTitle(text){ return /chapter\s*\d+/i.test(text||''); }

  function buildChapterIndex(){
    const slides = $$('.slide');
    const chapters = [];
    const slideMeta = new Array(slides.length);
    let open = null;

    for (let i=0;i<slides.length;i++){
      const h2 = $('h2', slides[i]);
      const t  = (h2?.textContent || '').trim();
      if (isChapterTitle(t)){
        if (open) open.end = i-1;
        open = { title: t, start: i, end: i };
        chapters.push(open);
      }
      slideMeta[i] = { chapterIdx: Math.max(chapters.length-1, 0) };
    }
    if (open) open.end = slides.length-1;

    // If no H2 chapters found, treat everything as one chapter
    if (!chapters.length){
      chapters.push({ title: 'Intro', start: 0, end: slides.length-1 });
      for (let i=0;i<slides.length;i++) slideMeta[i] = { chapterIdx: 0 };
    } else {
      // Preface slides belong to first chapter
      const first = chapters[0];
      for (let i=0;i<first.start;i++) slideMeta[i] = { chapterIdx: 0 };
      chapters[0].start = 0;
    }

    return { slides, chapters, slideMeta };
  }

  function ensureCounterUI(totalSlides, totalChapters){
    const counter = $('.slide-counter');
    if (!counter) return;

    // Only Chapter + Slide (no page count)
    counter.innerHTML = `
      Ch <span id="chapter-number">1</span>/<span id="chapter-count">${totalChapters}</span>
      • Slide <span id="slide-number">1</span>/<span id="slide-count">${totalSlides}</span>
    `;
  }

  function applyCounterBindings(ctx){
    const { slides, chapters, slideMeta } = ctx;

    function updateCounterFor(slideIdx){
      const m  = slideMeta[slideIdx] || { chapterIdx: 0 };
      const ch = chapters[m.chapterIdx] || { title:'Intro' };
      const chNumEl = byId('chapter-number');
      const chCntEl = byId('chapter-count');
      const slCntEl = byId('slide-count');

      if (chNumEl) chNumEl.textContent = String(m.chapterIdx + 1);
      if (chCntEl) chCntEl.textContent = String(chapters.length);
      if (slCntEl) slCntEl.textContent = String(slides.length);

      const sc = $('.slide-counter');
      if (sc) sc.title = ch.title;
    }

    // Wrap existing showSlide to also refresh chapter bits
    const prevShow = window.showSlide;
    window.showSlide = function(n){
      prevShow.call(this, n); // keeps your original behavior incl. slide-number
      const idx = (typeof window.currentSlide === 'number') ? window.currentSlide : n;
      updateCounterFor(idx);
    };

    // First paint
    const startIdx = (typeof window.currentSlide === 'number') ? window.currentSlide : 0;
    updateCounterFor(startIdx);
  }

  /* -----------------------
     2) Leaderboard (Map) + Winner Modal
  ----------------------- */
  const STORE_KEY = 'tp_leaderboard_v2';
  const DEFAULT_POINTS = 10;
  const AUTO_CLOSE_MS = 20000;

  function freshBoard(){ return { players:{}, lastUpdated: now() }; }
  function loadBoard(){
    try {
      const raw = localStorage.getItem(STORE_KEY);
      return raw ? (JSON.parse(raw) || freshBoard()) : freshBoard();
    } catch { return freshBoard(); }
  }
  function saveBoard(b){ b.lastUpdated = now(); localStorage.setItem(STORE_KEY, JSON.stringify(b)); }

  function levelFromScore(s){
    if (s>=200) return 'Grandmaster';
    if (s>=120) return 'Master';
    if (s>=70)  return 'Pro';
    if (s>=30)  return 'Skilled';
    return 'Beginner';
  }

  function toast(msg, color){
    if (typeof window.showMessage === 'function') window.showMessage(msg, color || '#4fc3f7');
    else console.log('%c'+msg, 'color:'+ (color || '#4fc3f7'));
  }

  // ensure tray exists; inject fixed button under the toggle
  function ensureTray(){
    let tray = byId('leaderboard-tray');
    if (!tray){
      document.body.insertAdjacentHTML('beforeend', `
        <div id="leaderboard-tray" class="leaderboard-tray">
          <button id="leaderboard-toggle" class="lb-btn">🏅 Leaderboard</button>
          <div id="leaderboard-compact" class="leaderboard compact hidden"></div>
          <div id="leaderboard-full" class="leaderboard full hidden"></div>
          <div id="leaderboard-actions" class="leaderboard-actions hidden">
            <button class="lb-btn" id="leaderboard-collapse">Collapse</button>
            <button class="lb-btn danger" id="leaderboard-clear">Clear</button>
          </div>
        </div>
      `);
      tray = byId('leaderboard-tray');
    }

    // Add (or ensure) the always-visible Add Winners button
    if (!byId('fixed-add-winner')) {
      const btn = document.createElement('button');
      btn.id = 'fixed-add-winner';
      btn.className = 'lb-btn primary';
      btn.textContent = '➕ Add winners';
      // Insert under the toggle button
      const toggle = byId('leaderboard-toggle');
      if (toggle?.nextSibling) tray.insertBefore(btn, toggle.nextSibling);
      else tray.appendChild(btn);

      btn.addEventListener('click', openWinnersForActiveSlide);
    }
  }

  // compact + full render helpers
  function fmtTime(ts){
    const d=new Date(ts), pad=n=>String(n).padStart(2,'0');
    return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
  }
  function flattenRecent(b){
    const out=[];
    Object.entries(b.players).forEach(([name, data])=>{
      (data.entries || []).forEach(en => out.push({ name, ...en }));
    });
    return out.sort((a,b)=>b.ts-a.ts).slice(0,3);
  }
  function renderLeaderboard(){
    const b = loadBoard();
    const lbC = byId('leaderboard-compact');
    const lbF = byId('leaderboard-full');

    if (lbC){
      const rec = flattenRecent(b);
      lbC.innerHTML = rec.length
        ? rec.map((r,i)=>`
          <div class="lb-row">
            <div>
              <div class="lb-name">#${i+1} ${r.name}</div>
              <div class="lb-meta">${r.quiz}${r.chapter ? (' (Ch '+r.chapter+')') : ''} • ${fmtTime(r.ts)}</div>
            </div>
            <div class="lb-score">+${r.points}</div>
          </div>`).join('')
        : '<div class="lb-meta">No winners yet</div>';
    }

    if (lbF){
      const arr = Object
        .entries(b.players)
        .map(([name, data]) => ({ name, total: (data.total|0), entries: data.entries || [] }))
        .sort((a,b)=> b.total - a.total || a.name.localeCompare(b.name));

      lbF.innerHTML = arr.length
        ? arr.map((p,idx)=>`
            <div class="lb-row" data-player="${p.name}">
              <div>
                <div class="lb-name">#${idx+1} ${p.name}</div>
                <div class="lb-meta">Total: ${p.total} pts • Click for details</div>
              </div>
              <div class="lb-score">🏆 ${p.total}</div>
            </div>
          `).join('')
        : '<div class="lb-meta">No players yet</div>';
    }
  }
  function expandLB(){
    byId('leaderboard-compact')?.classList.add('hidden');
    byId('leaderboard-full')?.classList.remove('hidden');
    byId('leaderboard-actions')?.classList.remove('hidden');
  }
  function collapseLB(){
    byId('leaderboard-compact')?.classList.add('hidden');
    byId('leaderboard-full')?.classList.add('hidden');
    byId('leaderboard-actions')?.classList.add('hidden');
  }

  function updateTopStatsBar(){
    const b = loadBoard();
    const top = Object.values(b.players).reduce((m,p)=>Math.max(m, p.total||0), 0);
    const cnt = Object.keys(b.players).length;
    const topEl   = byId('top-score');
    const countEl = byId('player-count');
    if (topEl)   topEl.textContent   = String(top);
    if (countEl) countEl.textContent = String(cnt);
  }

  /* -----------------------
     Winner modal (multi-row)
  ----------------------- */
  // remove duplicates if any
  function squashDuplicateModals(){
    const dups = $$('#wm-modal');
    for (let i=1;i<dups.length;i++) dups[i].remove();
    // retire any older, unused different id
    const legacy = byId('winner-modal');
    if (legacy) legacy.remove();
  }
  squashDuplicateModals();

  function ensureWinnerModal(){
    if (!byId('wm-modal')){
      document.body.insertAdjacentHTML('beforeend', `
        <div id="wm-modal" class="lb-modal hidden" aria-hidden="true">
          <div class="lb-card" role="dialog" aria-modal="true">
            <div class="lb-card-head">
              <div>
                <div class="lb-card-title">Add Winners</div>
                <div class="lb-card-sub" id="wm-desc">Reward this activity</div>
              </div>
              <button class="lb-x" id="wm-close" type="button">✕</button>
            </div>
            <div class="lb-rows-head"><span>Name</span><span>Points</span><span></span></div>
            <div id="wm-rows" class="lb-rows"></div>
            <div class="lb-row-actions">
              <button class="lb-btn" id="wm-add" type="button">+ Add more</button>
              <div class="lb-spacer"></div>
              <button class="lb-btn" id="wm-cancel" type="button">Cancel</button>
              <button class="lb-btn primary" id="wm-save" type="button">Save winners</button>
            </div>
          </div>
        </div>
      `);
    }
  }
  ensureWinnerModal();

  const modal   = byId('wm-modal');
  const rowsBox = byId('wm-rows');
  const descEl  = byId('wm-desc');
  const addBtn  = byId('wm-add');
  const saveBtn = byId('wm-save');
  const canBtn  = byId('wm-cancel');
  const xBtn    = byId('wm-close');

  let autoCloseTimer = null;
  function resetAutoClose(){
    clearTimeout(autoCloseTimer);
    autoCloseTimer = setTimeout(()=>{ closeWinnerModal(); toast('Popup closed due to inactivity.','#ff9800'); }, AUTO_CLOSE_MS);
  }
  function showWinnerModal(){
    if (!modal) return;
    modal.classList.remove('hidden');
    modal.style.display='grid';
    modal.setAttribute('aria-hidden','false');
    setTimeout(()=>$('.wm-name', rowsBox)?.focus(), 0);
    resetAutoClose();
  }
  function hideWinnerModal(){
    if (!modal) return;
    modal.classList.add('hidden');
    modal.style.display='none';
    modal.setAttribute('aria-hidden','true');
    clearTimeout(autoCloseTimer);
  }

  // State for the current award
  let currentActId = null;
  let defaultPoints = DEFAULT_POINTS;
  const actLocks = new Set(); // prevent double-awarding same act while popup open

  function addRow(name='', pts=defaultPoints){
    const row = document.createElement('div');
    row.className = 'lb-row';
    row.innerHTML = `
      <input type="text" class="wm-name" placeholder="Winner name" value="${(name||'').replace(/"/g,'&quot;')}">
      <input type="number" class="wm-points" min="0" step="1" value="${Number.isFinite(pts)?pts:defaultPoints}">
      <button type="button" class="rm">✕</button>
    `;
    $('.rm', row).addEventListener('click', ()=>{ row.remove(); resetAutoClose(); });
    row.addEventListener('input', resetAutoClose);
    rowsBox.appendChild(row);
  }

  function openWinnerModal(actId, pts, label){
    if (!modal) return;
    if (!actId) actId = 'manual-award';

    if (actLocks.has(actId)){
      toast('This award is already open. Finish it first.','#ff9800');
      return;
    }
    actLocks.add(actId);

    currentActId  = String(actId);
    defaultPoints = Number.isFinite(pts) ? pts : DEFAULT_POINTS;

    if (descEl) descEl.textContent = label || 'Quiz';

    rowsBox.innerHTML = '';
    addRow('', defaultPoints);

    showWinnerModal();
  }

  function closeWinnerModal(){
    if (currentActId) actLocks.delete(currentActId);
    currentActId = null;
    hideWinnerModal();
    rowsBox.innerHTML = '';
  }

  addBtn?.addEventListener('click', ()=>{ addRow('', defaultPoints); resetAutoClose(); });
  canBtn?.addEventListener('click', closeWinnerModal);
  xBtn?.addEventListener('click', closeWinnerModal);
  modal?.addEventListener('click', (e)=>{ if (e.target === modal) closeWinnerModal(); });
  modal?.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)){ e.preventDefault(); saveWinners(); }
    else if (e.key === 'Escape'){ e.preventDefault(); closeWinnerModal(); }
    resetAutoClose();
  });

  function alreadyCredited(board, name, act, quiz, chapter){
    // prefer activity id de-dupe; else (quiz+chapter) fallback
    const rec = board.players[name];
    if (!rec) return false;
    if (act)  return (rec.entries||[]).some(e => e.act === act);
    return (rec.entries||[]).some(e => e.act==null && e.quiz === (quiz||'Quiz') && e.chapter === (chapter ?? null));
  }

  function saveWinners(){
    try{
      const raw = $$('.lb-row', rowsBox).map(r=>{
        const n = $('.wm-name', r)?.value?.trim();
        const p = parseInt($('.wm-points', r)?.value, 10);
        return n ? { name:n, points:Number.isFinite(p)?p:defaultPoints } : null;
      }).filter(Boolean);

      // unique by name inside the popup
      const uniq = new Map();
      raw.forEach(w => { if (!uniq.has(w.name)) uniq.set(w.name, w); });
      const list = [...uniq.values()];
      if (!list.length){ closeWinnerModal(); return; }

      const board = loadBoard();
      const chNum = currentChapter();
      const activeSlide = $('.slide.active');
      // Label comes from descEl; if empty, grab a good heading from the slide
      let label = (descEl?.textContent || '').trim();
      if (!label){
        label = $('h3', activeSlide)?.textContent?.trim() ||
                $('h2', activeSlide)?.textContent?.trim() ||
                'Quiz';
      }

      const act = currentActId || (chNum ? `ch${chNum}:${slug(label)}` : slug(label));
      const ts  = now();

      const toAdd = [];
      const skipped = [];
      list.forEach(w => (alreadyCredited(board, w.name, act, label, chNum) ? skipped : toAdd).push(w));
      if (!toAdd.length){
        toast('No new winners to add for this challenge.','#ff9800');
        closeWinnerModal();
        return;
      }

      // Update your global "players" (compat)
      toAdd.forEach(({name, points})=>{
        if (!players[name]) players[name] = { score: 0, activities: new Set() };
        players[name].score += points;
        if (act) players[name].activities.add(act);
      });

      // Persist map structure
      toAdd.forEach(({name, points})=>{
        const rec = (board.players[name] ||= { total:0, entries:[] });
        rec.total  += points;
        rec.entries.push({ quiz: label, chapter: chNum ?? null, points, ts, act });
      });
      saveBoard(board);

      // UI updates
      renderLeaderboard();
      updateTopStatsBar();

      toast(
        `Awarded: ${toAdd.map(w=>`${w.name} (+${w.points})`).join(', ')}`
        + (skipped.length ? ` | Skipped: ${skipped.map(w=>w.name).join(', ')} (already credited)` : ''),
        '#4caf50'
      );

    } catch(err){
      console.error('Save winners failed:', err);
      toast('Could not save winners.','#f44336');
    } finally {
      closeWinnerModal(); // always auto-close after save
    }
  }
  saveBtn?.addEventListener('click', saveWinners);

  // Player detail modal
  function ensurePlayerDetailModal(){
    if (!byId('player-detail-modal')){
      document.body.insertAdjacentHTML('beforeend', `
        <div id="player-detail-modal" class="lb-modal hidden" aria-hidden="true">
          <div class="lb-card" role="dialog" aria-modal="true">
            <div class="lb-card-head">
              <div>
                <div class="lb-card-title" id="pd-title">Player</div>
                <div class="lb-card-sub" id="pd-sub">Level-wise points</div>
              </div>
              <button class="lb-x" id="pd-close" type="button">✕</button>
            </div>
            <div id="pd-body" class="lb-rows"></div>
          </div>
        </div>
      `);
    }
  }
  ensurePlayerDetailModal();

  const pd     = byId('player-detail-modal');
  const pdBody = byId('pd-body');
  const pdTitle= byId('pd-title');
  const pdSub  = byId('pd-sub');
  byId('pd-close')?.addEventListener('click', ()=>togglePD(false));
  pd?.addEventListener('click', e=>{ if (e.target === pd) togglePD(false); });

  function togglePD(show){
    if (!pd) return;
    if (show){
      pd.style.display='grid'; pd.classList.remove('hidden'); pd.setAttribute('aria-hidden','false');
    } else {
      pd.classList.add('hidden'); pd.style.display='none'; pd.setAttribute('aria-hidden','true');
      if (pdBody) pdBody.innerHTML='';
    }
  }
  function openPD(name){
    const b = loadBoard();
    const data = b.players[name];
    if (!data){ togglePD(false); return; }
    const lvl = levelFromScore(data.total);
    pdTitle.innerHTML = `Player: ${name} <span style="font-size:.75em;background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.35);padding:.15em .5em;border-radius:.75em;margin-left:.5em;">${lvl}</span>`;
    pdSub.textContent = `Total: ${data.total} pts • ${data.entries.length} quizzes`;

    const groups = {};
    (data.entries||[]).forEach(en=>{
      const key = en.chapter==null ? 'General' : `Chapter ${en.chapter}`;
      (groups[key] ||= { sum:0, items:[] }).sum += (en.points|0);
      groups[key].items.push(en);
    });
    const fmt = en => `${fmtTime(en.ts)} • ${en.quiz}${en.chapter ? (' (Ch '+en.chapter+')') : ''} • +${en.points}`;
    const parts = Object.entries(groups)
      .sort((a,b)=>{
        // sort by chapter number desc; General last
        const numA = parseInt(a[0].match(/\d+/)?.[0] || '-1', 10);
        const numB = parseInt(b[0].match(/\d+/)?.[0] || '-1', 10);
        return numB - numA;
      })
      .map(([label,g])=>`
        <div class="lb-row">
          <div>
            <div class="lb-name">${label}</div>
            <div class="lb-meta">Subtotal: ${g.sum} pts</div>
            <div class="lb-meta">${g.items.sort((x,y)=>y.ts-x.ts).map(fmt).join('<br>')}</div>
          </div>
          <div class="lb-score">+${g.sum}</div>
        </div>
      `);

    pdBody.innerHTML = parts.join('') || '<div class="lb-meta">No entries</div>';
    togglePD(true);
  }

  // Leaderboard clicks
  byId('leaderboard-full')?.addEventListener('click', (e)=>{
    const row = e.target.closest('.lb-row[data-player]');
    if (row) openPD(row.getAttribute('data-player'));
  });

  // Toggle/collapse click handlers
  byId('leaderboard-toggle')?.addEventListener('click', ()=>{
    const fullHidden = byId('leaderboard-full')?.classList.contains('hidden');
    if (fullHidden) expandLB(); else collapseLB();
  });
  byId('leaderboard-collapse')?.addEventListener('click', collapseLB);
  byId('leaderboard-clear')?.addEventListener('click', ()=>{
    if (confirm('Clear all winners?')){
      saveBoard(freshBoard());
      renderLeaderboard();
      updateTopStatsBar();
    }
  });

  /* -----------------------
     3) Always-visible Add Winners button behavior
  ----------------------- */
  function currentChapter(){
    return parseInt(byId('chapter-number')?.textContent || '') || null;
  }
  function openWinnersForActiveSlide(){
    const ch = currentChapter();
    const active = $('.slide.active');

    // Prefer a specific section heading; fallback to slide h2; fallback generic
    const label =
      $('.brain-teaser h3', active)?.textContent?.trim() ||
      $('.coding-challenge h3', active)?.textContent?.trim() ||
      $('.interactive-demo h3', active)?.textContent?.trim() ||
      $('h3', active)?.textContent?.trim() ||
      $('h2', active)?.textContent?.trim() ||
      'Quiz';

    const actId = `${ch ? ('ch'+ch+':') : ''}${slug(label)}`;
    openWinnerModal(actId, DEFAULT_POINTS, label);
  }

  /* -----------------------
     4) Boot
  ----------------------- */
  document.addEventListener('DOMContentLoaded', ()=>{
    // Hide legacy floating score/level badge; detail view shows level instead
    const sb = $('.score-board'); if (sb) sb.style.display = 'none';

    // Chapter counter
    const ctx = buildChapterIndex();
    ensureCounterUI(ctx.slides.length, ctx.chapters.length);
    applyCounterBindings(ctx);

    // Tray + fixed Add winners
    ensureTray();

    // First paint
    renderLeaderboard();
    collapseLB();           // make sure full list is hidden when collapsed
    updateTopStatsBar();    // top score + total players
  });
})();
    </script>
    
    <script>
/* Fix: make only the current quiz block non-clickable; keep others active */
(function () {
  const $  = (s, r=document)=>r.querySelector(s);
  const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));

  function quizContainerOf(el){
    return el.closest('.brain-teaser, .coding-challenge, .interactive-demo, .story-box, .problem-statement, .solution-approach, .algorithm-step') || document;
  }
  function markOption(el, isCorrect){
    el.classList.add(isCorrect ? 'correct' : 'incorrect');
  }
  function msg(text, color){
    if (typeof window.showMessage === 'function') window.showMessage(text, color || '#ff9800');
  }

  // --- Override handlers to scope within the current quiz block ---
  window.checkAnswer = function(optionOrEl, isCorrect, quizId = 'general-quiz') {
    const el = (optionOrEl && optionOrEl.nodeType === 1) ? optionOrEl : (event?.currentTarget || this);
    const container = quizContainerOf(el);

    // Only disable options inside THIS quiz container
    const opts = $$('.quiz-option', container);
    opts.forEach(o => {
      o.style.pointerEvents = 'none';
      o.classList.remove('correct', 'incorrect');
    });

    markOption(el, isCorrect);

    if (isCorrect) {
      if (typeof window.awardPoints === 'function') {
        const actId = `quiz-${quizId}-${Date.now()}`; // unique-ish ID for this attempt
        window.awardPoints(actId, 15, 'Correct answer to quiz question!');
      }
    } else {
      msg('Not quite right, but keep learning! 🤔', '#ff9800');
    }
  };

  window.checkPattern = function(optionOrEl, isCorrect) {
    return window.checkAnswer.call(this, optionOrEl, isCorrect, 'pattern-recognition');
  };

  window.checkPerformance = function(optionOrEl, isCorrect) {
    const el = (optionOrEl && optionOrEl.nodeType === 1) ? optionOrEl : (event?.currentTarget || this);
    const container = quizContainerOf(el);
    const exp = $('#performance-explanation', container) || document.getElementById('performance-explanation');
    if (isCorrect && exp) exp.classList.remove('hidden');
    return window.checkAnswer.call(this, el, isCorrect, 'performance-analysis');
  };

  // --- Re-enable options when the slide changes (so next teasers are clickable) ---
  const prevShowSlide = window.showSlide;
  window.showSlide = function(n){
    if (typeof prevShowSlide === 'function') prevShowSlide.call(this, n);
    const active = document.querySelector('.slide.active');
    if (active){
      $$('.quiz-option', active).forEach(o => {
        o.style.pointerEvents = '';   // reset to default
        o.classList.remove('correct', 'incorrect'); // optional: clear styling
      });
    }
  };

  // --- One-time cleanup in case a previous quiz already disabled everything ---
  document.addEventListener('DOMContentLoaded', () => {
    $$('.quiz-option').forEach(o => { o.style.pointerEvents = ''; });
  });
})();
    </script>



<!-- Winner Modal -->
<div id="winner-modal" class="lb-modal hidden" aria-hidden="true">
  <div class="lb-card" role="dialog" aria-modal="true">
    <div class="lb-card-head">
      <div>
        <div class="lb-card-title">Add Winners</div>
        <div class="lb-card-sub" id="wm-quiz-title">Quiz</div>
      </div>
      <button class="lb-x" id="wm-close" title="Close">✕</button>
    </div>

    <div class="lb-rows-head">
      <span>Name</span>
      <span>Points</span>
    </div>
    <div id="winner-rows" class="lb-rows"></div>

    <div class="lb-row-actions">
      <button class="lb-btn" id="wm-add-more">+ Add more</button>
      <div class="lb-spacer"></div>
      <button class="lb-btn" id="wm-cancel">Cancel</button>
      <button class="lb-btn primary" id="wm-save">Save winners</button>
    </div>
  </div>
</div>

<!-- Multi-winner popup -->
<div id="wm-modal" class="lb-modal hidden" aria-hidden="true">
  <div class="lb-card" role="dialog" aria-modal="true">
    <div class="lb-card-head">
      <div>
        <div class="lb-card-title">Add Winners</div>
        <div class="lb-card-sub" id="wm-desc">Reward this activity</div>
      </div>
      <button class="lb-x" id="wm-close" title="Close">✕</button>
    </div>

    <div class="lb-rows-head"><span>Name</span><span>Points</span><span></span></div>
    <div id="wm-rows" class="lb-rows"></div>

    <div class="lb-row-actions">
      <button class="lb-btn" id="wm-add">+ Add more</button>
      <div class="lb-spacer"></div>
      <button class="lb-btn" id="wm-cancel">Cancel</button>
      <button class="lb-btn primary" id="wm-save">Save winners</button>
    </div>
  </div>
</div>

</body>
</html>
