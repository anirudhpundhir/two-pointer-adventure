<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kingdom Gate</title>
<style>
  *{ box-sizing:border-box }
  html,body{ height:100% }
  body{
    margin:0; background:#000; color:#fff; font-family:Arial,Helvetica,sans-serif;
    overflow:hidden;
  }

  /* Fullscreen stage */
  .stage{ position:fixed; inset:0; }
  video#hero{
    position:absolute; inset:0; width:100%; height:100%;
    object-fit:cover; object-position:center;
    background:#000;
  }

  /* End-of-video options overlay (10s) */
  .overlay{
    position:absolute; inset:0; display:grid; place-items:center;
    background: radial-gradient(60% 60% at 50% 40%, rgba(0,0,0,.15), rgba(0,0,0,.55));
    opacity:0; visibility:hidden; pointer-events:none;
    transition: opacity .25s ease, visibility .25s ease;
  }
  .overlay.show{ opacity:1; visibility:visible; pointer-events:auto; }

  .panel{
    width:min(720px,92vw);
    background:linear-gradient(135deg, rgba(255,255,255,.18), rgba(255,255,255,.08));
    border:1px solid rgba(255,255,255,.28);
    border-radius:18px; padding:18px 16px;
    backdrop-filter: blur(10px);
    box-shadow:0 16px 48px rgba(0,0,0,.35);
    text-align:center;
  }
  .panel h1{ margin:.25rem 0 .25rem; font-size:clamp(22px,4.5vw,36px) }
  .panel p{ margin:.25rem 0 .75rem; opacity:.95 }
  .actions{ display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:6px }
  .btn{
    padding:12px 16px; border-radius:999px; font-weight:800;
    border:1px solid rgba(255,255,255,.35);
    color:#333; background:linear-gradient(135deg, #ffeb3b, #ffc107);
    cursor:pointer; text-decoration:none; display:inline-flex; align-items:center; gap:8px;
    transition:transform .15s ease, box-shadow .2s ease;
  }
  .btn:hover{ transform:translateY(-2px); box-shadow:0 10px 24px rgba(0,0,0,.28) }
  .btn.ghost{ color:#fff; background:linear-gradient(135deg, rgba(255,255,255,.2), rgba(255,255,255,.1)) }

  .count{ margin-top:8px; font-size:.95rem; opacity:.9 }

  /* Autoplay gate if browser blocks video */
  .gate{
    position:absolute; inset:0; display:grid; place-items:center;
    background: radial-gradient(60% 60% at 50% 40%, rgba(0,0,0,.25), rgba(0,0,0,.75));
    opacity:0; visibility:hidden; pointer-events:none;
    transition: opacity .25s ease, visibility .25s ease;
  }
  .gate.show{ opacity:1; visibility:visible; pointer-events:auto; }
  .gate .panel p{ margin-bottom:.5rem }

  @media (max-width:520px){
    .actions{ flex-direction:column }
  }
</style>
</head>
<body>
  <main class="stage">
    <!-- Your animation video. Keep MP4 as a fallback if possible. -->
    <video id="hero" autoplay muted playsinline preload="auto" poster="./poster.png">
      <source src="./kingdom-door.mp4" type="video/mp4" />
      <!-- If you have WebM too:
      <source src="./kingdom-door.webm" type="video/webm" /> -->
    </video>

    <!-- End-of-video overlay (shows for 10s, then auto-replay) -->
    <div id="overlay" class="overlay" aria-hidden="true">
      <div class="panel" role="dialog" aria-modal="true" aria-labelledby="ovl-title">
        <h1 id="ovl-title">Choose your path, traveler</h1>
        <p>Pick an option in the next <span id="count">10</span> seconds, or the gate animation will replay.</p>
        <div class="actions">
          <a class="btn" href="./two-pointer-kingdom-story.html">üîì Start the Adventure</a>
          <a class="btn ghost" href="./two-pointer-intro.html">üìú Two-Pointer Starter Guide</a>
        </div>
        <div class="count">Auto-replay in <span id="count2">10</span>s</div>
      </div>
    </div>

    <!-- Autoplay blocked gate -->
    <div id="tapGate" class="gate" aria-hidden="true">
      <div class="panel">
        <h1>Welcome to the Kingdom</h1>
        <p>Your browser blocked autoplay for this video.</p>
        <button id="playBtn" class="btn">‚ñ∂Ô∏è Play</button>
        <div class="actions">
          <a class="btn ghost" href="./two-pointer-intro.html">üìú Starter Guide</a>
        </div>
      </div>
    </div>
  </main>

<script>
(function(){
  const video = document.getElementById('hero');
  const overlay = document.getElementById('overlay');
  const tapGate = document.getElementById('tapGate');
  const count1 = document.getElementById('count');
  const count2 = document.getElementById('count2');
  const playBtn = document.getElementById('playBtn');

  let countdownTimer = null;
  const OVERLAY_SECONDS = 10;

  function showOverlay(){
    // reset counters
    let left = OVERLAY_SECONDS;
    count1.textContent = left;
    count2.textContent = left;

    overlay.classList.add('show');
    overlay.setAttribute('aria-hidden','false');

    // start ticking
    clearInterval(countdownTimer);
    countdownTimer = setInterval(()=>{
      left--;
      count1.textContent = left;
      count2.textContent = left;
      if (left <= 0){
        hideOverlay();
        restartVideo();
      }
    }, 1000);
  }

  function hideOverlay(){
    overlay.classList.remove('show');
    overlay.setAttribute('aria-hidden','true');
    clearInterval(countdownTimer);
    countdownTimer = null;
  }

  function restartVideo(){
    try{
      video.currentTime = 0;
      const p = video.play();
      if (p && typeof p.catch === 'function'){
        p.catch(()=> showTapGate());
      }
    }catch(e){
      showTapGate();
    }
  }

  function showTapGate(){
    tapGate.classList.add('show');
    tapGate.setAttribute('aria-hidden','false');
  }
  function hideTapGate(){
    tapGate.classList.remove('show');
    tapGate.setAttribute('aria-hidden','true');
  }

  // When video finishes, show overlay for 10s
  video.addEventListener('ended', showOverlay);

  // If playing (again), hide the overlay
  video.addEventListener('play', hideOverlay);

  // Try autoplay on load; if it fails, show tap gate
  function tryAutoplay(){
    // iOS/Android need muted+playsinline (we already have)
    const start = video.play();
    if (start && typeof start.catch === 'function'){
      start.catch(()=> showTapGate());
    }
  }

  // If user taps Play on the gate, play video
  playBtn.addEventListener('click', ()=>{
    hideTapGate();
    tryAutoplay();
  });

  // Handle visibility change (optional): pause when tab hidden to avoid ending silently
  document.addEventListener('visibilitychange', ()=>{
    if (document.hidden){
      try{ video.pause(); }catch(e){}
    } else {
      // don‚Äôt auto resume if we were at the overlay
      if (overlay.classList.contains('show')) return;
      tryAutoplay();
    }
  });

  // Kick off
  // Some browsers fire 'canplay' late; we attempt immediately and let catch() open the gate
  tryAutoplay();
})();
</script>
</body>
</html>
